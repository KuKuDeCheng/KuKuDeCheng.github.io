---
title: MySQL行锁、临键锁、间隙锁
date: 2023-07-27
category: 面试
---

行锁、临键锁、间隙锁，都是 Mysql 里面 InnoDB 引擎下解决`事务隔离性`的一系列`排他锁`。

## 行锁

也称为记录锁。当我们针对主键或者唯一索引加锁的时候，Mysql 默认会 对查询的这一行数据加行锁， 避免其他事务对这一行数据进行修改。

select * from t where id = 1 for update

## 间隙锁

顾名思义，就是锁定一个索引`区间`。 在普通索引或者唯一索引列上，由于索引是基于 `B+树`的结构存储，所以默认会 存在一个索引区间。 而间隙锁，就是某个事物对索引列加锁的时候，默认锁定对应索引的左右开区间 范围。

在`基于索引列的范围查询`，无论是否是唯一索引，都会自动触发间隙锁。 比如基于 between 的范围查询，就会`产生一个左右开区间的间隙锁`。

select * from t where id between 1 and 3 for update

## 临键锁

它相当于行锁+间隙锁的组合，也就是它的锁定范围既包含 了索引记录，也包含了索引区间

它会锁定一个左开右闭区间的数据范围。

假设我们使用`非唯一索引列`进行查询的时候，默认会加一个临键锁，锁定一个左 开右闭区间的范围。

select * from t where age = 11 for update

所以总的来说，行锁、临键锁、间隙锁只是表示锁定数据的范围，最终目的是为 了`解决幻读`的问题。 而`临键锁相当于行锁+间隙锁`，因此当我们使用非唯一索引进行`精准匹配`的时候， 会默认加临键锁，因为它需要锁定匹配的这一行数据，还需要锁定这一行数据对 应的左开右闭区间。

因此在实际应用中，尽可能使用唯一索引或者主键索引进行查询，避免大面积的 锁定造成性能影响。 以上就是我对这个问题的理解.

## 面试点评 

关于数据库里面的事务隔离级别，以及解决隔离级别的底层原理。 在面试中也非常常见。 像 Mysql 里面的很多种锁的类型，除了应对面试以外，我认为对实际应用开发 也有很好的指导意义。 也就是如何在保证数据安全性的同时平衡好性能。
