<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.46" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://zhangchengk.github.io/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html"><meta property="og:site_name" content="Panda诚的博客"><meta property="og:title" content="深入解析调度策略"><meta property="og:type" content="article"><meta property="og:image" content="https://zhangchengk.github.io/"><meta property="og:updated_time" content="2022-05-31T14:27:10.000Z"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="深入解析调度策略"><meta property="article:tag" content="NIFI"><meta property="article:published_time" content="2020-06-08T00:00:00.000Z"><meta property="article:modified_time" content="2022-05-31T14:27:10.000Z"><link rel="stylesheet" href="//at.alicdn.com/t/font_2410206_mfj6e1vbwo.css"><meta name="referrer" content="no-referrer"><link rel="icon" href="/logo.png"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>深入解析调度策略 | Panda诚的博客</title><meta name="description" content="古来圣贤皆贫贱 何况我辈孤且直">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.cc6c27f0.css">
    <link rel="modulepreload" href="/assets/app.17aaeba5.js"><link rel="modulepreload" href="/assets/016-NIFI调度.html.17475e25.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/016-NIFI调度.html.1c5cb3ab.js"><link rel="prefetch" href="/assets/index.html.0fcae25a.js"><link rel="prefetch" href="/assets/001-编译NIFI源码.html.c496243e.js"><link rel="prefetch" href="/assets/002-NIFI自定义开发规范.html.61d8c3a1.js"><link rel="prefetch" href="/assets/003-Processor的一些方法.html.a2b16c2e.js"><link rel="prefetch" href="/assets/004-自定义Processor.html.9271631a.js"><link rel="prefetch" href="/assets/005-自定义ExpressionLanguage.html.ad33e143.js"><link rel="prefetch" href="/assets/006-NIFI启动源码.html.3ea3f3bf.js"><link rel="prefetch" href="/assets/007-在HTTP模式下开启权限模块.html.9aec8b47.js"><link rel="prefetch" href="/assets/008-JettyServer源码.html.472255c7.js"><link rel="prefetch" href="/assets/009-NiFi源码.html.3a8c4dd7.js"><link rel="prefetch" href="/assets/010-nifi注解.html.9daf0e7e.js"><link rel="prefetch" href="/assets/011-Debezium详细嵌入NIFI.html.582e8382.js"><link rel="prefetch" href="/assets/RunNiFi源码.html.50c06419.js"><link rel="prefetch" href="/assets/nifi-env-sh.html.7e84946c.js"><link rel="prefetch" href="/assets/nifi-sh-start.html.f31bbd2e.js"><link rel="prefetch" href="/assets/nifi-sh.html.08d29b28.js"><link rel="prefetch" href="/assets/000-ApacheNIFI历史.html.806a551a.js"><link rel="prefetch" href="/assets/001-NiFi术语.html.582292c1.js"><link rel="prefetch" href="/assets/002-带你体验ApacheNIFI.html.681ba0d3.js"><link rel="prefetch" href="/assets/003-NIFI入门.html.7e110846.js"><link rel="prefetch" href="/assets/004-数据抽取的常见方法.html.6d006b7c.js"><link rel="prefetch" href="/assets/005-基于增量字段同步数据.html.35b70ea1.js"><link rel="prefetch" href="/assets/006-NIFI各个NAR包功能概述.html.f21ae8f4.js"><link rel="prefetch" href="/assets/007-Nar包加载机制源码解读.html.b84fdf9d.js"><link rel="prefetch" href="/assets/008-Nar包下的MANIFEST.MF.html.ba4d3f9c.js"><link rel="prefetch" href="/assets/009-Apache NIFI类资源隔离机制.html.c4a257fc.js"><link rel="prefetch" href="/assets/010-Apache NIFI Processor情况.html.a6552e04.js"><link rel="prefetch" href="/assets/011-理解connection.html.fea18d6d.js"><link rel="prefetch" href="/assets/012-理解maxThread设置.html.69d32085.js"><link rel="prefetch" href="/assets/013-RunDuration理解.html.7b0ef0c6.js"><link rel="prefetch" href="/assets/014-ContentRepositoryArchiving理解.html.342999f7.js"><link rel="prefetch" href="/assets/015-Controller Services是守护进程.html.329513c6.js"><link rel="prefetch" href="/assets/017-NIFI高可用.html.60faa3c5.js"><link rel="prefetch" href="/assets/018-通过配置优化NiFi性能.html.21761c46.js"><link rel="prefetch" href="/assets/019-NIFI里的数据库连接池.html.892d384e.js"><link rel="prefetch" href="/assets/020-为什么建议使用NIFI里的Record.html.80537fe1.js"><link rel="prefetch" href="/assets/021-NIFI贡献代码.html.21ff3b9f.js"><link rel="prefetch" href="/assets/022-NIFI开启HTTPS.html.efc1feb7.js"><link rel="prefetch" href="/assets/023-ExecuteScript脚本教程.html.51b0d91b.js"><link rel="prefetch" href="/assets/024-内容存储库原理.html.bc869787.js"><link rel="prefetch" href="/assets/025-FlowFile存储库原理.html.cc042d20.js"><link rel="prefetch" href="/assets/026-预写日志(WAL).html.cffdea77.js"><link rel="prefetch" href="/assets/027-Provenance存储库原理.html.ec904ccd.js"><link rel="prefetch" href="/assets/028-NIFI架构.html.8854ade8.js"><link rel="prefetch" href="/assets/029-NIFI事务原理.html.e77f76b5.js"><link rel="prefetch" href="/assets/030-数据库字段类型.html.783d7846.js"><link rel="prefetch" href="/assets/031-1.14.html.8663ef1f.js"><link rel="prefetch" href="/assets/032-CaptureChangeMySQL.html.dfe5a778.js"><link rel="prefetch" href="/assets/033-流程告警.html.de388c03.js"><link rel="prefetch" href="/assets/034-JWT.html.d628ed27.js"><link rel="prefetch" href="/assets/037-MySQL全字段测试.html.22dd89c8.js"><link rel="prefetch" href="/assets/01-输入输出流.html.3cb7129d.js"><link rel="prefetch" href="/assets/02-File.html.83ffda0d.js"><link rel="prefetch" href="/assets/03-缓冲流BufferedInputStream与BufferedOutputStream.html.78fc1e00.js"><link rel="prefetch" href="/assets/04-缓冲流BufferedReader与BufferedWriter.html.e006a52e.js"><link rel="prefetch" href="/assets/05-转换流InputStreamReader与OutputStreamWriter.html.fc8a10e3.js"><link rel="prefetch" href="/assets/06-ByteArrayInputStream与ByteArrayOutputStream.html.0bbd0cfd.js"><link rel="prefetch" href="/assets/07-CommonsIO2.5-FileUtils.html.638b2e2f.js"><link rel="prefetch" href="/assets/ByteArrayOutputStream.html.6957a084.js"><link rel="prefetch" href="/assets/Java SPI机制.html.42fc5241.js"><link rel="prefetch" href="/assets/Java8_JVM内存模型.html.de707242.js"><link rel="prefetch" href="/assets/Java中atomic包中的原子操作类总结.html.4fdd73c9.js"><link rel="prefetch" href="/assets/Java中的锁.html.e2f8bc99.js"><link rel="prefetch" href="/assets/Java内存模型原理.html.e95a2195.js"><link rel="prefetch" href="/assets/Java反射.html.4ecbdec6.js"><link rel="prefetch" href="/assets/Java导入语句中不宜使用通配符.html.74d2db2d.js"><link rel="prefetch" href="/assets/Java类加载器.html.17f2c707.js"><link rel="prefetch" href="/assets/Java里带标签的break和continue.html.46ca85e0.js"><link rel="prefetch" href="/assets/Jvm-dump-jstack-jmap-jstat.html.3bb54971.js"><link rel="prefetch" href="/assets/java注解.html.19e9a712.js"><link rel="prefetch" href="/assets/web的发展历史.html.be5afdd1.js"><link rel="prefetch" href="/assets/代码设计原理.html.9168676e.js"><link rel="prefetch" href="/assets/使用List.html.5749f733.js"><link rel="prefetch" href="/assets/偏向锁批量重偏向与批量撤销.html.92547243.js"><link rel="prefetch" href="/assets/到底什么是classpath.html.ed6ac9ea.js"><link rel="prefetch" href="/assets/动手体验JVM中Class对象的唯一性.html.81d4153d.js"><link rel="prefetch" href="/assets/多线程基础知识总结.html.85c727bd.js"><link rel="prefetch" href="/assets/打印Java对象头.html.53828c35.js"><link rel="prefetch" href="/assets/深入了解Java锁.html.31c337c9.js"><link rel="prefetch" href="/assets/相对路径与绝对路径去读取文件.html.6dabf159.js"><link rel="prefetch" href="/assets/类加载机制.html.3f3fe5df.js"><link rel="prefetch" href="/assets/线程通信.html.01ba9d14.js"><link rel="prefetch" href="/assets/让你彻底理解Synchronized.html.15a8ae9e.js"><link rel="prefetch" href="/assets/JsonJolt教程.html.1bb06cba.js"><link rel="prefetch" href="/assets/JsonJolt教程英文版.html.4e28289e.js"><link rel="prefetch" href="/assets/使用jolt替换值.html.08bb93eb.js"><link rel="prefetch" href="/assets/001Spring基础知识.html.aae1ddd6.js"><link rel="prefetch" href="/assets/002Bean定义常见错误.html.e14a6e38.js"><link rel="prefetch" href="/assets/003依赖注入常见错误上.html.ee865dd6.js"><link rel="prefetch" href="/assets/004依赖注入常见错误下.html.11ee7b02.js"><link rel="prefetch" href="/assets/005Bean生命周期常见错误.html.605393fe.js"><link rel="prefetch" href="/assets/intro.html.67565d0d.js"><link rel="prefetch" href="/assets/qq.html.8fe9c932.js"><link rel="prefetch" href="/assets/wechat.html.ed99719d.js"><link rel="prefetch" href="/assets/001-管理OracleRedoLog.html.2edd7960.js"><link rel="prefetch" href="/assets/BIT的字节序.html.310c94f0.js"><link rel="prefetch" href="/assets/Oracle12cLogMiner分析Redo日志文件.html.5c9d01f9.js"><link rel="prefetch" href="/assets/基于水印的CDC框架.html.34611ca0.js"><link rel="prefetch" href="/assets/01-进程与线程基本概念.html.2de5cb5c.js"><link rel="prefetch" href="/assets/02-Java多线程入门类和接口.html.61f473d2.js"><link rel="prefetch" href="/assets/03-线程组和线程优先级.html.10956f92.js"><link rel="prefetch" href="/assets/04-Java线程的状态及主要转化方法.html.57fc3555.js"><link rel="prefetch" href="/assets/05-Java线程间的通信.html.1dad9615.js"><link rel="prefetch" href="/assets/06-Java内存模型基础知识.html.ef809786.js"><link rel="prefetch" href="/assets/07-重排序与happens-before.html.36eca085.js"><link rel="prefetch" href="/assets/08-volatitle.html.d6d7c7bb.js"><link rel="prefetch" href="/assets/09-synchronized与锁.html.2b8762d7.js"><link rel="prefetch" href="/assets/10-CAS与原子操作.html.1d9f0cc5.js"><link rel="prefetch" href="/assets/11-AQS.html.2fd5c3e2.js"><link rel="prefetch" href="/assets/12-线程池原理.html.1aa5d301.js"><link rel="prefetch" href="/assets/13-阻塞队列.html.c3fc8ad8.js"><link rel="prefetch" href="/assets/14-锁接口和类.html.fb7e52ba.js"><link rel="prefetch" href="/assets/15-并发容器集合.html.81c82bf3.js"><link rel="prefetch" href="/assets/16-CopyOnWrite容器.html.63194b5b.js"><link rel="prefetch" href="/assets/17-通信工具类.html.6082e9dc.js"><link rel="prefetch" href="/assets/18-Fork_Join框架.html.e77d4a29.js"><link rel="prefetch" href="/assets/19-Java8Stream并行计算原理.html.0d62da55.js"><link rel="prefetch" href="/assets/20-计划任务.html.0d355ed5.js"><link rel="prefetch" href="/assets/深入浅出Java多线程.html.c268f98b.js"><link rel="prefetch" href="/assets/sf.html.8f305e05.js"><link rel="prefetch" href="/assets/二叉搜索树的前驱和后继节点.html.a0101f40.js"><link rel="prefetch" href="/assets/什么是红黑树.html.724a2226.js"><link rel="prefetch" href="/assets/冒泡排序.html.5256122d.js"><link rel="prefetch" href="/assets/十大经典排序算法最强总结.html.dbd3826f.js"><link rel="prefetch" href="/assets/基于Java实现红黑树的基本操作.html.a601a58b.js"><link rel="prefetch" href="/assets/并查集.html.2bdbf229.js"><link rel="prefetch" href="/assets/01-命名风格.html.cbe54c3a.js"><link rel="prefetch" href="/assets/02-常量定义.html.0e347c9f.js"><link rel="prefetch" href="/assets/03-代码格式.html.e2fc3243.js"><link rel="prefetch" href="/assets/04-OOP规约.html.019473ea.js"><link rel="prefetch" href="/assets/05-日期时间.html.b8feee5f.js"><link rel="prefetch" href="/assets/06-集合处理.html.2f3397b2.js"><link rel="prefetch" href="/assets/07-并发处理.html.c5062a71.js"><link rel="prefetch" href="/assets/08-控制语句.html.9b863553.js"><link rel="prefetch" href="/assets/09-注释规约.html.e731dc15.js"><link rel="prefetch" href="/assets/10-其它.html.db65550b.js"><link rel="prefetch" href="/assets/11-错误码.html.e9f27e99.js"><link rel="prefetch" href="/assets/12-异常处理.html.1284aa38.js"><link rel="prefetch" href="/assets/13-日志规约.html.06be32ad.js"><link rel="prefetch" href="/assets/14-单元测试.html.8f113221.js"><link rel="prefetch" href="/assets/15-安全规约.html.eb2c57f4.js"><link rel="prefetch" href="/assets/16-建表规约.html.5916c17f.js"><link rel="prefetch" href="/assets/17-索引规约.html.cb5ce999.js"><link rel="prefetch" href="/assets/18-SQL语句.html.1700f3e4.js"><link rel="prefetch" href="/assets/19-ORM映射.html.66a6c2a0.js"><link rel="prefetch" href="/assets/20-应用分层.html.b213eda8.js"><link rel="prefetch" href="/assets/21-二方库依赖.html.36d8083c.js"><link rel="prefetch" href="/assets/22-服务器.html.54a98a94.js"><link rel="prefetch" href="/assets/23-设计规约.html.e8dd5d11.js"><link rel="prefetch" href="/assets/24-专有名词解释.html.a2eceb00.js"><link rel="prefetch" href="/assets/25-错误码列表.html.ad5511e8.js"><link rel="prefetch" href="/assets/手抄版.html.7673c2e6.js"><link rel="prefetch" href="/assets/综合.html.5c9e6804.js"><link rel="prefetch" href="/assets/HikariCP文档简译.html.1c91be7d.js"><link rel="prefetch" href="/assets/linux之如何清理磁盘空间.html.a44a5572.js"><link rel="prefetch" href="/assets/linux如何启动nginx.html.20cfd331.js"><link rel="prefetch" href="/assets/linux安装jdk8.html.114cf345.js"><link rel="prefetch" href="/assets/linux查看crontab任务执行情况.html.19e55921.js"><link rel="prefetch" href="/assets/安装yum.html.405de94f.js"><link rel="prefetch" href="/assets/Maven-Mirror配置.html.f90a0d42.js"><link rel="prefetch" href="/assets/MavenAssembly配置详细解释.html.05104faf.js"><link rel="prefetch" href="/assets/Maven发版名词介绍.html.2e89642b.js"><link rel="prefetch" href="/assets/POM文件中依赖的版本锁定.html.26a2f776.js"><link rel="prefetch" href="/assets/clean-compile-build-install-package.html.f0357f96.js"><link rel="prefetch" href="/assets/maven-assembly-plugin的使用.html.4660ced5.js"><link rel="prefetch" href="/assets/maven压缩解压使jar文件损坏.html.e9d4c6c6.js"><link rel="prefetch" href="/assets/maven打包去除版本号.html.61c2c3ec.js"><link rel="prefetch" href="/assets/maven打包重命名jar.html.6e861834.js"><link rel="prefetch" href="/assets/maven的dependency参数.html.d1a6d977.js"><link rel="prefetch" href="/assets/Gitee Pages自动部署.html.13d33a32.js"><link rel="prefetch" href="/assets/Git切换远程仓库.html.ae02814b.js"><link rel="prefetch" href="/assets/Mac的Mat打开失败解决方案.html.2f101643.js"><link rel="prefetch" href="/assets/MySQL不要再使用UTF-8了.html.98599b69.js"><link rel="prefetch" href="/assets/MySQL创建触发器.html.9121067c.js"><link rel="prefetch" href="/assets/MySQL字段类型.html.1f5eb008.js"><link rel="prefetch" href="/assets/java.sql.Types的具体对应值jdbcType.html.83a47d2f.js"><link rel="prefetch" href="/assets/sqlserver对应Java中的数据类型.html.4835352e.js"><link rel="prefetch" href="/assets/互联网术语.html.cc6e8ef8.js"><link rel="prefetch" href="/assets/什么是乐观锁_什么是悲观锁.html.08758091.js"><link rel="prefetch" href="/assets/大数据的4v.html.93e8234e.js"><link rel="prefetch" href="/assets/字体颜色工具.html.fba6f193.js"><link rel="prefetch" href="/assets/按位置读取ResultSet比按名称快.html.f12ffc21.js"><link rel="prefetch" href="/assets/无效的列索引.html.bd68e51c.js"><link rel="prefetch" href="/assets/普罗米修斯安装MAC版.html.42a181e1.js"><link rel="prefetch" href="/assets/深入HTTPS加解密原理.html.d1610297.js"><link rel="prefetch" href="/assets/编码和编码格式.html.e624af3c.js"><link rel="prefetch" href="/assets/聊聊HTTPS和SSL_TLS协议.html.9331609e.js"><link rel="prefetch" href="/assets/docker介绍.html.4c9c8ace.js"><link rel="prefetch" href="/assets/安装k8s.html.3a393ace.js"><link rel="prefetch" href="/assets/CAS底层原理.html.1ea842a1.js"><link rel="prefetch" href="/assets/Contended.html.aae79969.js"><link rel="prefetch" href="/assets/Java动态代理.html.d291b50b.js"><link rel="prefetch" href="/assets/从硬件层面理解memorybarrier.html.db8092b0.js"><link rel="prefetch" href="/assets/技术路线图.html.fb687e2f.js"><link rel="prefetch" href="/assets/磁盘原理介绍.html.baef1ada.js"><link rel="prefetch" href="/assets/类加载器.html.e59a5a66.js"><link rel="prefetch" href="/assets/锁.html.4256142b.js"><link rel="prefetch" href="/assets/哪些操作导致了上下文切换.html.d3536139.js"><link rel="prefetch" href="/assets/如何优化多线程上下文切换.html.00e6b096.js"><link rel="prefetch" href="/assets/如何用协程来优化多线程业务.html.607afd25.js"><link rel="prefetch" href="/assets/操作系统缓存.html.78cd9467.js"><link rel="prefetch" href="/assets/进程线程上下文切换会用掉你多少CPU.html.687153f4.js"><link rel="prefetch" href="/assets/security排查.html.2c03ae44.js"><link rel="prefetch" href="/assets/1innoDB 如何解决幻读.html.6d216335.js"><link rel="prefetch" href="/assets/1简单说一下 Mysql 的事务隔离级别.html.604e2e24.js"><link rel="prefetch" href="/assets/2MySQL行锁、临键锁、间隙锁.html.0c0d9198.js"><link rel="prefetch" href="/assets/3MySQL事务实现原理.html.c1e4c9c8.js"><link rel="prefetch" href="/assets/4Mysql 索引的优点和缺点.html.d644383b.js"><link rel="prefetch" href="/assets/5Mysql为什么使用B_Tree作为索引结构.html.0967fd00.js"><link rel="prefetch" href="/assets/6什么是聚集索引和非聚集索引.html.edaf6cd4.js"><link rel="prefetch" href="/assets/7索引什么时候失效.html.899acbef.js"><link rel="prefetch" href="/assets/Spring 中 BeanFactory 和 FactoryBean 的区别.html.c0bc7e20.js"><link rel="prefetch" href="/assets/如何理解 Spring Boot 中的 Starter.html.33b57937.js"><link rel="prefetch" href="/assets/谈谈你对 Spring IOC 和 DI 的理解.html.9d08d3bd.js"><link rel="prefetch" href="/assets/01谈谈你对Java平台的理解.html.bc79d76f.js"><link rel="prefetch" href="/assets/02Exception和Error有什么区别.html.f85bef08.js"><link rel="prefetch" href="/assets/03谈谈final-finally-finalize有什么不同.html.6c56d927.js"><link rel="prefetch" href="/assets/04强引用-软引用-弱引用-幻象引用有什么区别.html.f25cdf9c.js"><link rel="prefetch" href="/assets/05String-StringBuffer-StringBuilder有什么区别.html.22a90d5b.js"><link rel="prefetch" href="/assets/1-两数之和.html.148a3d22.js"><link rel="prefetch" href="/assets/2-两数相加.html.f4a539ca.js"><link rel="prefetch" href="/assets/3-无重复字符的最长子串.html.fb0c076a.js"><link rel="prefetch" href="/assets/4-寻找两个有序数组的中位数.html.0c082032.js"><link rel="prefetch" href="/assets/5-最长回文子串.html.07da3ddb.js"><link rel="prefetch" href="/assets/6-Z字形变换.html.cb6c994f.js"><link rel="prefetch" href="/assets/sfxc.html.60bdf7c8.js"><link rel="prefetch" href="/assets/刷二叉搜索树.html.85f2100f.js"><link rel="prefetch" href="/assets/刷平衡二叉树.html.df1e7114.js"><link rel="prefetch" href="/assets/动态规划详解.html.724111ff.js"><link rel="prefetch" href="/assets/回溯算法详解.html.8886ac24.js"><link rel="prefetch" href="/assets/学习算法和刷题的思路指南.html.972aa833.js"><link rel="prefetch" href="/assets/带你刷二叉树.html.b40a3a0d.js"><link rel="prefetch" href="/assets/1Spring的整体架构.html.87c5eff3.js"><link rel="prefetch" href="/assets/2Spring的结构组成.html.ce708588.js"><link rel="prefetch" href="/assets/3容器的基础XmlBeanFactory.html.3d6a959f.js"><link rel="prefetch" href="/assets/4Spring中的FactoryBean.html.0f5378cb.js"><link rel="prefetch" href="/assets/01-冯·诺依曼体系结构.html.b931ee40.js"><link rel="prefetch" href="/assets/02-计算机组成原理应该这么学.html.604a8f5f.js"><link rel="prefetch" href="/assets/03-我们来谈谈性能究竟是什么.html.6d86c145.js"><link rel="prefetch" href="/assets/04-我们该从哪些方面提升性能.html.746e26cb.js"><link rel="prefetch" href="/assets/深入浅出计算机组成原理.html.1d6ac107.js"><link rel="prefetch" href="/assets/01-记忆宫殿的起源.html.c7cdf424.js"><link rel="prefetch" href="/assets/02-记忆宫殿的原理.html.4cca080f.js"><link rel="prefetch" href="/assets/03-记忆宫殿速记体验.html.5391b611.js"><link rel="prefetch" href="/assets/04-机械记忆.html.1f858782.js"><link rel="prefetch" href="/assets/05-逻辑记忆.html.2e2a8fe2.js"><link rel="prefetch" href="/assets/06-图像记忆.html.c92291ca.js"><link rel="prefetch" href="/assets/07-代替法.html.91a1a1ed.js"><link rel="prefetch" href="/assets/08-记忆术起点锁链法.html.236b6c3e.js"><link rel="prefetch" href="/assets/09-固定法.html.8bd9e86e.js"><link rel="prefetch" href="/assets/10-固定法之记忆力测试.html.4f7064c1.js"><link rel="prefetch" href="/assets/11-固定法之地点桩记忆体验.html.20bcc10b.js"><link rel="prefetch" href="/assets/12-固定法之千位数字定位系统.html.60822990.js"><link rel="prefetch" href="/assets/13-固定法之记忆宫殿实战.html.e198c2b1.js"><link rel="prefetch" href="/assets/14-记忆的宏观理论.html.5e1d58bb.js"><link rel="prefetch" href="/assets/15-视觉图像是一切记忆的基础.html.13cb2a26.js"><link rel="prefetch" href="/assets/16-快速记忆的秘密.html.9e0fc3d6.js"><link rel="prefetch" href="/assets/17-什么是联想.html.456ea1d8.js"><link rel="prefetch" href="/assets/18-记忆思维的演变.html.ffbf2933.js"><link rel="prefetch" href="/assets/19-记忆术基本功发散训练.html.492ad793.js"><link rel="prefetch" href="/assets/20-联结的技巧.html.e4d0a604.js"><link rel="prefetch" href="/assets/21-记忆术基本功之逻辑联想法.html.d8d8ec1c.js"><link rel="prefetch" href="/assets/22-记忆术基本功之逻辑推理记忆信息.html.a9d6221e.js"><link rel="prefetch" href="/assets/23-记忆术基本功之故事法.html.61bdf53c.js"><link rel="prefetch" href="/assets/24-记忆术基础训练抽象词汇串联.html.a8f0d741.js"><link rel="prefetch" href="/assets/25-记忆术之词性串联训练.html.28edb592.js"><link rel="prefetch" href="/assets/26-记忆术基本功之归纳简化.html.1b7c825c.js"><link rel="prefetch" href="/assets/27-口诀记忆.html.bb1397e7.js"><link rel="prefetch" href="/assets/28-绘图记忆法.html.20fc2452.js"><link rel="prefetch" href="/assets/29-比喻记忆法.html.14c703fd.js"><link rel="prefetch" href="/assets/30-内视觉出图七要素.html.824653d8.js"><link rel="prefetch" href="/assets/31-创造和加工图像.html.a02e56c4.js"><link rel="prefetch" href="/assets/32-万物皆桩.html.49939956.js"><link rel="prefetch" href="/assets/33-一对一联结训练.html.21866a58.js"><link rel="prefetch" href="/assets/34-记忆初级万能公式.html.e9d5c3e2.js"><link rel="prefetch" href="/assets/35-记忆术的两种核心技巧谐音和逻辑.html.87f23aa9.js"><link rel="prefetch" href="/assets/36-关键词记忆法.html.55c73b6a.js"><link rel="prefetch" href="/assets/37-如何集中注意力.html.6510c391.js"><link rel="prefetch" href="/assets/38-视觉化的窍门.html.7948a5f7.js"><link rel="prefetch" href="/assets/39-意群的逻辑图像转化.html.62b7724f.js"><link rel="prefetch" href="/assets/40-意群图像记忆的步骤.html.b884256f.js"><link rel="prefetch" href="/assets/41-文字编码库.html.90fea43f.js"><link rel="prefetch" href="/assets/42-现实记忆宫殿.html.ed5f8c60.js"><link rel="prefetch" href="/assets/43-虚拟记忆宫殿.html.ff9d83ae.js"><link rel="prefetch" href="/assets/44-随机记忆宫殿.html.69aff499.js"><link rel="prefetch" href="/assets/45-记忆宫殿之人物系统.html.abffa47c.js"><link rel="prefetch" href="/assets/46-五种方法记单词.html.0d2a0353.js"><link rel="prefetch" href="/assets/1简述一下你对线程池的理解.html.6817f514.js"><link rel="prefetch" href="/assets/2线程池如何知道一个线程的任务已经执 行完成.html.b91df263.js"><link rel="prefetch" href="/assets/3Java 官方提供了哪几种线程池，分别有 什么特点？.html.3fdf85db.js"><link rel="prefetch" href="/assets/0怎么理解线程安全.html.af9399fa.js"><link rel="prefetch" href="/assets/1ConcurrentHashMap 底层具体实现.html.15e588ec.js"><link rel="prefetch" href="/assets/2谈一下 CAS 机制.html.3f6e9a68.js"><link rel="prefetch" href="/assets/3谈谈 AQS 是怎么回事.html.120fc2b8.js"><link rel="prefetch" href="/assets/4ReentrantLock 是如何实现锁公平和非 公平性的.html.7a8015ab.js"><link rel="prefetch" href="/assets/DCL 单例模式设计为什么需要 volatile 修饰实例对象.html.4e741010.js"><link rel="prefetch" href="/assets/SimpleDateFormat 是线程安全的吗.html.80803128.js"><link rel="prefetch" href="/assets/wait 和 sleep 是否会触发锁的释放以及 CPU 资源的释放.html.4ae02600.js"><link rel="prefetch" href="/assets/一个线程两次调用 start()，会出现什 么问题.html.bfcf59d7.js"><link rel="prefetch" href="/assets/404.html.ebf25b44.js"><link rel="prefetch" href="/assets/index.html.2e0b4132.js"><link rel="prefetch" href="/assets/index.html.c36f22c4.js"><link rel="prefetch" href="/assets/index.html.66f2a5c9.js"><link rel="prefetch" href="/assets/index.html.6d501d9d.js"><link rel="prefetch" href="/assets/index.html.5de2e56d.js"><link rel="prefetch" href="/assets/index.html.72905fb5.js"><link rel="prefetch" href="/assets/index.html.2a314b55.js"><link rel="prefetch" href="/assets/index.html.6f1fe3f6.js"><link rel="prefetch" href="/assets/index.html.e4619cbd.js"><link rel="prefetch" href="/assets/index.html.c8d14614.js"><link rel="prefetch" href="/assets/index.html.44e40c7d.js"><link rel="prefetch" href="/assets/index.html.db8ea907.js"><link rel="prefetch" href="/assets/index.html.9eaa2298.js"><link rel="prefetch" href="/assets/index.html.a2fa5af7.js"><link rel="prefetch" href="/assets/index.html.bb15c424.js"><link rel="prefetch" href="/assets/index.html.0d05725d.js"><link rel="prefetch" href="/assets/index.html.4eaac003.js"><link rel="prefetch" href="/assets/index.html.59d21196.js"><link rel="prefetch" href="/assets/index.html.f3a717f9.js"><link rel="prefetch" href="/assets/index.html.45b79d3a.js"><link rel="prefetch" href="/assets/index.html.c2e82826.js"><link rel="prefetch" href="/assets/index.html.efd5d7be.js"><link rel="prefetch" href="/assets/index.html.aaeb789f.js"><link rel="prefetch" href="/assets/index.html.3d51cf46.js"><link rel="prefetch" href="/assets/index.html.b94ffc24.js"><link rel="prefetch" href="/assets/index.html.a7ed61b6.js"><link rel="prefetch" href="/assets/index.html.6d0aa9c2.js"><link rel="prefetch" href="/assets/index.html.a9b8fd24.js"><link rel="prefetch" href="/assets/index.html.88d67a57.js"><link rel="prefetch" href="/assets/index.html.27492764.js"><link rel="prefetch" href="/assets/index.html.b9d31689.js"><link rel="prefetch" href="/assets/index.html.aafecb06.js"><link rel="prefetch" href="/assets/index.html.e439dcec.js"><link rel="prefetch" href="/assets/index.html.12614e6e.js"><link rel="prefetch" href="/assets/index.html.1b6d1b29.js"><link rel="prefetch" href="/assets/index.html.d18333bc.js"><link rel="prefetch" href="/assets/index.html.003623a2.js"><link rel="prefetch" href="/assets/index.html.d35c0591.js"><link rel="prefetch" href="/assets/001-编译NIFI源码.html.80ec433a.js"><link rel="prefetch" href="/assets/002-NIFI自定义开发规范.html.e90b95ec.js"><link rel="prefetch" href="/assets/003-Processor的一些方法.html.7aafc335.js"><link rel="prefetch" href="/assets/004-自定义Processor.html.07a9a1c4.js"><link rel="prefetch" href="/assets/005-自定义ExpressionLanguage.html.52349c4e.js"><link rel="prefetch" href="/assets/006-NIFI启动源码.html.a45bdcdb.js"><link rel="prefetch" href="/assets/007-在HTTP模式下开启权限模块.html.8340811a.js"><link rel="prefetch" href="/assets/008-JettyServer源码.html.c0405556.js"><link rel="prefetch" href="/assets/009-NiFi源码.html.f56b2a0c.js"><link rel="prefetch" href="/assets/010-nifi注解.html.593392af.js"><link rel="prefetch" href="/assets/011-Debezium详细嵌入NIFI.html.1d9c777d.js"><link rel="prefetch" href="/assets/RunNiFi源码.html.b29fc617.js"><link rel="prefetch" href="/assets/nifi-env-sh.html.c7d00d8b.js"><link rel="prefetch" href="/assets/nifi-sh-start.html.907d24b0.js"><link rel="prefetch" href="/assets/nifi-sh.html.e4982064.js"><link rel="prefetch" href="/assets/000-ApacheNIFI历史.html.e75788bc.js"><link rel="prefetch" href="/assets/001-NiFi术语.html.28e29f2e.js"><link rel="prefetch" href="/assets/002-带你体验ApacheNIFI.html.6ebc9329.js"><link rel="prefetch" href="/assets/003-NIFI入门.html.c50e00e4.js"><link rel="prefetch" href="/assets/004-数据抽取的常见方法.html.ce7edb50.js"><link rel="prefetch" href="/assets/005-基于增量字段同步数据.html.3cc71bfa.js"><link rel="prefetch" href="/assets/006-NIFI各个NAR包功能概述.html.0962770d.js"><link rel="prefetch" href="/assets/007-Nar包加载机制源码解读.html.88564f87.js"><link rel="prefetch" href="/assets/008-Nar包下的MANIFEST.MF.html.4c977db9.js"><link rel="prefetch" href="/assets/009-Apache NIFI类资源隔离机制.html.ea309ff6.js"><link rel="prefetch" href="/assets/010-Apache NIFI Processor情况.html.d8f2d1d6.js"><link rel="prefetch" href="/assets/011-理解connection.html.407c3819.js"><link rel="prefetch" href="/assets/012-理解maxThread设置.html.060d1f81.js"><link rel="prefetch" href="/assets/013-RunDuration理解.html.cc6add3b.js"><link rel="prefetch" href="/assets/014-ContentRepositoryArchiving理解.html.19d24d81.js"><link rel="prefetch" href="/assets/015-Controller Services是守护进程.html.11475108.js"><link rel="prefetch" href="/assets/017-NIFI高可用.html.3dfa7841.js"><link rel="prefetch" href="/assets/018-通过配置优化NiFi性能.html.e2a103d7.js"><link rel="prefetch" href="/assets/019-NIFI里的数据库连接池.html.d818b439.js"><link rel="prefetch" href="/assets/020-为什么建议使用NIFI里的Record.html.8ab19970.js"><link rel="prefetch" href="/assets/021-NIFI贡献代码.html.cbf5b8de.js"><link rel="prefetch" href="/assets/022-NIFI开启HTTPS.html.27217983.js"><link rel="prefetch" href="/assets/023-ExecuteScript脚本教程.html.519c0e81.js"><link rel="prefetch" href="/assets/024-内容存储库原理.html.db9d4fec.js"><link rel="prefetch" href="/assets/025-FlowFile存储库原理.html.d816825e.js"><link rel="prefetch" href="/assets/026-预写日志(WAL).html.a6baaa8d.js"><link rel="prefetch" href="/assets/027-Provenance存储库原理.html.44a9ed4d.js"><link rel="prefetch" href="/assets/028-NIFI架构.html.ee312cce.js"><link rel="prefetch" href="/assets/029-NIFI事务原理.html.95142daf.js"><link rel="prefetch" href="/assets/030-数据库字段类型.html.11ae692f.js"><link rel="prefetch" href="/assets/031-1.14.html.cd843d87.js"><link rel="prefetch" href="/assets/032-CaptureChangeMySQL.html.6c483c98.js"><link rel="prefetch" href="/assets/033-流程告警.html.82c9632a.js"><link rel="prefetch" href="/assets/034-JWT.html.674d3912.js"><link rel="prefetch" href="/assets/037-MySQL全字段测试.html.6013c6f9.js"><link rel="prefetch" href="/assets/01-输入输出流.html.22527688.js"><link rel="prefetch" href="/assets/02-File.html.5b6656cb.js"><link rel="prefetch" href="/assets/03-缓冲流BufferedInputStream与BufferedOutputStream.html.49c344e9.js"><link rel="prefetch" href="/assets/04-缓冲流BufferedReader与BufferedWriter.html.d398e3a8.js"><link rel="prefetch" href="/assets/05-转换流InputStreamReader与OutputStreamWriter.html.afcda8ba.js"><link rel="prefetch" href="/assets/06-ByteArrayInputStream与ByteArrayOutputStream.html.f6a54112.js"><link rel="prefetch" href="/assets/07-CommonsIO2.5-FileUtils.html.e7dcaacf.js"><link rel="prefetch" href="/assets/ByteArrayOutputStream.html.cb4897db.js"><link rel="prefetch" href="/assets/Java SPI机制.html.aca35f1b.js"><link rel="prefetch" href="/assets/Java8_JVM内存模型.html.5b1d5dbf.js"><link rel="prefetch" href="/assets/Java中atomic包中的原子操作类总结.html.939d24fe.js"><link rel="prefetch" href="/assets/Java中的锁.html.c2677419.js"><link rel="prefetch" href="/assets/Java内存模型原理.html.f704cd1f.js"><link rel="prefetch" href="/assets/Java反射.html.2476927c.js"><link rel="prefetch" href="/assets/Java导入语句中不宜使用通配符.html.5c0498ad.js"><link rel="prefetch" href="/assets/Java类加载器.html.dc50e746.js"><link rel="prefetch" href="/assets/Java里带标签的break和continue.html.3a23691a.js"><link rel="prefetch" href="/assets/Jvm-dump-jstack-jmap-jstat.html.8802d161.js"><link rel="prefetch" href="/assets/java注解.html.fcd95189.js"><link rel="prefetch" href="/assets/web的发展历史.html.193df572.js"><link rel="prefetch" href="/assets/代码设计原理.html.139fc7eb.js"><link rel="prefetch" href="/assets/使用List.html.2f4552fd.js"><link rel="prefetch" href="/assets/偏向锁批量重偏向与批量撤销.html.c32d3889.js"><link rel="prefetch" href="/assets/到底什么是classpath.html.8f8d648b.js"><link rel="prefetch" href="/assets/动手体验JVM中Class对象的唯一性.html.03895a5f.js"><link rel="prefetch" href="/assets/多线程基础知识总结.html.5b3e7c9a.js"><link rel="prefetch" href="/assets/打印Java对象头.html.cb7de361.js"><link rel="prefetch" href="/assets/深入了解Java锁.html.7299bf05.js"><link rel="prefetch" href="/assets/相对路径与绝对路径去读取文件.html.8f3a17f0.js"><link rel="prefetch" href="/assets/类加载机制.html.e28a4f48.js"><link rel="prefetch" href="/assets/线程通信.html.903d2665.js"><link rel="prefetch" href="/assets/让你彻底理解Synchronized.html.f40d36d7.js"><link rel="prefetch" href="/assets/JsonJolt教程.html.97fc4940.js"><link rel="prefetch" href="/assets/JsonJolt教程英文版.html.b960dfd3.js"><link rel="prefetch" href="/assets/使用jolt替换值.html.6121bc70.js"><link rel="prefetch" href="/assets/001Spring基础知识.html.7e85fe8f.js"><link rel="prefetch" href="/assets/002Bean定义常见错误.html.caf96802.js"><link rel="prefetch" href="/assets/003依赖注入常见错误上.html.0f7be454.js"><link rel="prefetch" href="/assets/004依赖注入常见错误下.html.671f9284.js"><link rel="prefetch" href="/assets/005Bean生命周期常见错误.html.e7938875.js"><link rel="prefetch" href="/assets/intro.html.58f57861.js"><link rel="prefetch" href="/assets/qq.html.71c63e26.js"><link rel="prefetch" href="/assets/wechat.html.daa7cc30.js"><link rel="prefetch" href="/assets/001-管理OracleRedoLog.html.688597ba.js"><link rel="prefetch" href="/assets/BIT的字节序.html.b0f0814b.js"><link rel="prefetch" href="/assets/Oracle12cLogMiner分析Redo日志文件.html.7ed2878e.js"><link rel="prefetch" href="/assets/基于水印的CDC框架.html.9ab85b2b.js"><link rel="prefetch" href="/assets/01-进程与线程基本概念.html.291c4809.js"><link rel="prefetch" href="/assets/02-Java多线程入门类和接口.html.3ca5bd3c.js"><link rel="prefetch" href="/assets/03-线程组和线程优先级.html.c4d99fc2.js"><link rel="prefetch" href="/assets/04-Java线程的状态及主要转化方法.html.409cc64d.js"><link rel="prefetch" href="/assets/05-Java线程间的通信.html.70a2c6bb.js"><link rel="prefetch" href="/assets/06-Java内存模型基础知识.html.9c70ac91.js"><link rel="prefetch" href="/assets/07-重排序与happens-before.html.5b84f5f8.js"><link rel="prefetch" href="/assets/08-volatitle.html.bf5748f6.js"><link rel="prefetch" href="/assets/09-synchronized与锁.html.2f3e774b.js"><link rel="prefetch" href="/assets/10-CAS与原子操作.html.9c438690.js"><link rel="prefetch" href="/assets/11-AQS.html.20d260a2.js"><link rel="prefetch" href="/assets/12-线程池原理.html.8a7e3225.js"><link rel="prefetch" href="/assets/13-阻塞队列.html.2ea8e872.js"><link rel="prefetch" href="/assets/14-锁接口和类.html.22b7b132.js"><link rel="prefetch" href="/assets/15-并发容器集合.html.b39f7140.js"><link rel="prefetch" href="/assets/16-CopyOnWrite容器.html.1360d191.js"><link rel="prefetch" href="/assets/17-通信工具类.html.3cb728d6.js"><link rel="prefetch" href="/assets/18-Fork_Join框架.html.d8b9b111.js"><link rel="prefetch" href="/assets/19-Java8Stream并行计算原理.html.a108311b.js"><link rel="prefetch" href="/assets/20-计划任务.html.13338662.js"><link rel="prefetch" href="/assets/深入浅出Java多线程.html.c2c327f5.js"><link rel="prefetch" href="/assets/sf.html.59bd64f3.js"><link rel="prefetch" href="/assets/二叉搜索树的前驱和后继节点.html.d06afedd.js"><link rel="prefetch" href="/assets/什么是红黑树.html.679b87e1.js"><link rel="prefetch" href="/assets/冒泡排序.html.3e121f12.js"><link rel="prefetch" href="/assets/十大经典排序算法最强总结.html.036e5ad3.js"><link rel="prefetch" href="/assets/基于Java实现红黑树的基本操作.html.ad6b0a81.js"><link rel="prefetch" href="/assets/并查集.html.cd6d0c5a.js"><link rel="prefetch" href="/assets/01-命名风格.html.0a9c79c5.js"><link rel="prefetch" href="/assets/02-常量定义.html.83350231.js"><link rel="prefetch" href="/assets/03-代码格式.html.4678e0fe.js"><link rel="prefetch" href="/assets/04-OOP规约.html.84df3e26.js"><link rel="prefetch" href="/assets/05-日期时间.html.05f80703.js"><link rel="prefetch" href="/assets/06-集合处理.html.a561f5bf.js"><link rel="prefetch" href="/assets/07-并发处理.html.303819e4.js"><link rel="prefetch" href="/assets/08-控制语句.html.114509cc.js"><link rel="prefetch" href="/assets/09-注释规约.html.3bdb710c.js"><link rel="prefetch" href="/assets/10-其它.html.4c2834db.js"><link rel="prefetch" href="/assets/11-错误码.html.169b45c9.js"><link rel="prefetch" href="/assets/12-异常处理.html.e6007482.js"><link rel="prefetch" href="/assets/13-日志规约.html.fec97b00.js"><link rel="prefetch" href="/assets/14-单元测试.html.fbc4a5bf.js"><link rel="prefetch" href="/assets/15-安全规约.html.6144a16a.js"><link rel="prefetch" href="/assets/16-建表规约.html.a1b5af8f.js"><link rel="prefetch" href="/assets/17-索引规约.html.311c82f1.js"><link rel="prefetch" href="/assets/18-SQL语句.html.62d2fa2f.js"><link rel="prefetch" href="/assets/19-ORM映射.html.a2d5ea0d.js"><link rel="prefetch" href="/assets/20-应用分层.html.80021f2c.js"><link rel="prefetch" href="/assets/21-二方库依赖.html.58aa6ec3.js"><link rel="prefetch" href="/assets/22-服务器.html.e64030f4.js"><link rel="prefetch" href="/assets/23-设计规约.html.3ad0ae60.js"><link rel="prefetch" href="/assets/24-专有名词解释.html.26db68ed.js"><link rel="prefetch" href="/assets/25-错误码列表.html.57305f5e.js"><link rel="prefetch" href="/assets/手抄版.html.87538c25.js"><link rel="prefetch" href="/assets/综合.html.b52b5b3b.js"><link rel="prefetch" href="/assets/HikariCP文档简译.html.a63836b1.js"><link rel="prefetch" href="/assets/linux之如何清理磁盘空间.html.171ce7c4.js"><link rel="prefetch" href="/assets/linux如何启动nginx.html.0cd59b4d.js"><link rel="prefetch" href="/assets/linux安装jdk8.html.a847bcae.js"><link rel="prefetch" href="/assets/linux查看crontab任务执行情况.html.95c7a3e1.js"><link rel="prefetch" href="/assets/安装yum.html.a1b6ba75.js"><link rel="prefetch" href="/assets/Maven-Mirror配置.html.5db93e1e.js"><link rel="prefetch" href="/assets/MavenAssembly配置详细解释.html.f72077c5.js"><link rel="prefetch" href="/assets/Maven发版名词介绍.html.b835e2a9.js"><link rel="prefetch" href="/assets/POM文件中依赖的版本锁定.html.ffe088f5.js"><link rel="prefetch" href="/assets/clean-compile-build-install-package.html.dbc41b69.js"><link rel="prefetch" href="/assets/maven-assembly-plugin的使用.html.982d28c7.js"><link rel="prefetch" href="/assets/maven压缩解压使jar文件损坏.html.cc49194f.js"><link rel="prefetch" href="/assets/maven打包去除版本号.html.8ecb7265.js"><link rel="prefetch" href="/assets/maven打包重命名jar.html.ff32f0ea.js"><link rel="prefetch" href="/assets/maven的dependency参数.html.7ad13cf9.js"><link rel="prefetch" href="/assets/Gitee Pages自动部署.html.062d95a7.js"><link rel="prefetch" href="/assets/Git切换远程仓库.html.40c4bdc0.js"><link rel="prefetch" href="/assets/Mac的Mat打开失败解决方案.html.3e60515b.js"><link rel="prefetch" href="/assets/MySQL不要再使用UTF-8了.html.c23e400a.js"><link rel="prefetch" href="/assets/MySQL创建触发器.html.c9d3df34.js"><link rel="prefetch" href="/assets/MySQL字段类型.html.afe0b083.js"><link rel="prefetch" href="/assets/java.sql.Types的具体对应值jdbcType.html.7e47a4c4.js"><link rel="prefetch" href="/assets/sqlserver对应Java中的数据类型.html.67a0011c.js"><link rel="prefetch" href="/assets/互联网术语.html.5c837097.js"><link rel="prefetch" href="/assets/什么是乐观锁_什么是悲观锁.html.943dbe21.js"><link rel="prefetch" href="/assets/大数据的4v.html.67b7b118.js"><link rel="prefetch" href="/assets/字体颜色工具.html.0942198d.js"><link rel="prefetch" href="/assets/按位置读取ResultSet比按名称快.html.7989a9ec.js"><link rel="prefetch" href="/assets/无效的列索引.html.0def8bf0.js"><link rel="prefetch" href="/assets/普罗米修斯安装MAC版.html.753755b5.js"><link rel="prefetch" href="/assets/深入HTTPS加解密原理.html.17eb1ed9.js"><link rel="prefetch" href="/assets/编码和编码格式.html.275c2331.js"><link rel="prefetch" href="/assets/聊聊HTTPS和SSL_TLS协议.html.e3c7b594.js"><link rel="prefetch" href="/assets/docker介绍.html.bfc46e74.js"><link rel="prefetch" href="/assets/安装k8s.html.cad0e0b6.js"><link rel="prefetch" href="/assets/CAS底层原理.html.2dea41ce.js"><link rel="prefetch" href="/assets/Contended.html.2adf75eb.js"><link rel="prefetch" href="/assets/Java动态代理.html.bb0da948.js"><link rel="prefetch" href="/assets/从硬件层面理解memorybarrier.html.5031b1a1.js"><link rel="prefetch" href="/assets/技术路线图.html.26b0e7f7.js"><link rel="prefetch" href="/assets/磁盘原理介绍.html.a06752ac.js"><link rel="prefetch" href="/assets/类加载器.html.c8d8c9fd.js"><link rel="prefetch" href="/assets/锁.html.0b8e7d61.js"><link rel="prefetch" href="/assets/哪些操作导致了上下文切换.html.d9fc9a28.js"><link rel="prefetch" href="/assets/如何优化多线程上下文切换.html.7301ec49.js"><link rel="prefetch" href="/assets/如何用协程来优化多线程业务.html.bbe5aa98.js"><link rel="prefetch" href="/assets/操作系统缓存.html.30335371.js"><link rel="prefetch" href="/assets/进程线程上下文切换会用掉你多少CPU.html.f8faefd4.js"><link rel="prefetch" href="/assets/security排查.html.6b848b34.js"><link rel="prefetch" href="/assets/1innoDB 如何解决幻读.html.1f05f6c7.js"><link rel="prefetch" href="/assets/1简单说一下 Mysql 的事务隔离级别.html.161ea6d1.js"><link rel="prefetch" href="/assets/2MySQL行锁、临键锁、间隙锁.html.4327756b.js"><link rel="prefetch" href="/assets/3MySQL事务实现原理.html.ca4fbbf4.js"><link rel="prefetch" href="/assets/4Mysql 索引的优点和缺点.html.4e0a7ace.js"><link rel="prefetch" href="/assets/5Mysql为什么使用B_Tree作为索引结构.html.ebc6e586.js"><link rel="prefetch" href="/assets/6什么是聚集索引和非聚集索引.html.8527ca0a.js"><link rel="prefetch" href="/assets/7索引什么时候失效.html.9488e478.js"><link rel="prefetch" href="/assets/Spring 中 BeanFactory 和 FactoryBean 的区别.html.0ed58684.js"><link rel="prefetch" href="/assets/如何理解 Spring Boot 中的 Starter.html.18431bff.js"><link rel="prefetch" href="/assets/谈谈你对 Spring IOC 和 DI 的理解.html.e381b371.js"><link rel="prefetch" href="/assets/01谈谈你对Java平台的理解.html.b5baf6cc.js"><link rel="prefetch" href="/assets/02Exception和Error有什么区别.html.daa61d89.js"><link rel="prefetch" href="/assets/03谈谈final-finally-finalize有什么不同.html.79da6007.js"><link rel="prefetch" href="/assets/04强引用-软引用-弱引用-幻象引用有什么区别.html.2fd47dbc.js"><link rel="prefetch" href="/assets/05String-StringBuffer-StringBuilder有什么区别.html.1fba0ced.js"><link rel="prefetch" href="/assets/1-两数之和.html.61de8cdd.js"><link rel="prefetch" href="/assets/2-两数相加.html.d2a254c4.js"><link rel="prefetch" href="/assets/3-无重复字符的最长子串.html.b3009cb0.js"><link rel="prefetch" href="/assets/4-寻找两个有序数组的中位数.html.fffadd5d.js"><link rel="prefetch" href="/assets/5-最长回文子串.html.d153c6c1.js"><link rel="prefetch" href="/assets/6-Z字形变换.html.f90ca812.js"><link rel="prefetch" href="/assets/sfxc.html.13afeeca.js"><link rel="prefetch" href="/assets/刷二叉搜索树.html.15427557.js"><link rel="prefetch" href="/assets/刷平衡二叉树.html.115d64ff.js"><link rel="prefetch" href="/assets/动态规划详解.html.c27332da.js"><link rel="prefetch" href="/assets/回溯算法详解.html.6d2d7d4b.js"><link rel="prefetch" href="/assets/学习算法和刷题的思路指南.html.a185c8ea.js"><link rel="prefetch" href="/assets/带你刷二叉树.html.d032b2f3.js"><link rel="prefetch" href="/assets/1Spring的整体架构.html.7736b3e3.js"><link rel="prefetch" href="/assets/2Spring的结构组成.html.1588112c.js"><link rel="prefetch" href="/assets/3容器的基础XmlBeanFactory.html.a293c00f.js"><link rel="prefetch" href="/assets/4Spring中的FactoryBean.html.f891410e.js"><link rel="prefetch" href="/assets/01-冯·诺依曼体系结构.html.3f3cc644.js"><link rel="prefetch" href="/assets/02-计算机组成原理应该这么学.html.5cc0d956.js"><link rel="prefetch" href="/assets/03-我们来谈谈性能究竟是什么.html.f093c5bd.js"><link rel="prefetch" href="/assets/04-我们该从哪些方面提升性能.html.75e0bb1a.js"><link rel="prefetch" href="/assets/深入浅出计算机组成原理.html.b217209c.js"><link rel="prefetch" href="/assets/01-记忆宫殿的起源.html.e213df77.js"><link rel="prefetch" href="/assets/02-记忆宫殿的原理.html.5c6620a0.js"><link rel="prefetch" href="/assets/03-记忆宫殿速记体验.html.282b9d23.js"><link rel="prefetch" href="/assets/04-机械记忆.html.bc0ddc96.js"><link rel="prefetch" href="/assets/05-逻辑记忆.html.62c08283.js"><link rel="prefetch" href="/assets/06-图像记忆.html.d8d6762b.js"><link rel="prefetch" href="/assets/07-代替法.html.ca0857a9.js"><link rel="prefetch" href="/assets/08-记忆术起点锁链法.html.0daa8274.js"><link rel="prefetch" href="/assets/09-固定法.html.9eb98337.js"><link rel="prefetch" href="/assets/10-固定法之记忆力测试.html.7a578944.js"><link rel="prefetch" href="/assets/11-固定法之地点桩记忆体验.html.ede75160.js"><link rel="prefetch" href="/assets/12-固定法之千位数字定位系统.html.1332c75b.js"><link rel="prefetch" href="/assets/13-固定法之记忆宫殿实战.html.47e30dca.js"><link rel="prefetch" href="/assets/14-记忆的宏观理论.html.baf2b836.js"><link rel="prefetch" href="/assets/15-视觉图像是一切记忆的基础.html.3de5b62f.js"><link rel="prefetch" href="/assets/16-快速记忆的秘密.html.3b10f85e.js"><link rel="prefetch" href="/assets/17-什么是联想.html.5586b672.js"><link rel="prefetch" href="/assets/18-记忆思维的演变.html.c3774dbd.js"><link rel="prefetch" href="/assets/19-记忆术基本功发散训练.html.aac7d683.js"><link rel="prefetch" href="/assets/20-联结的技巧.html.7cb782ee.js"><link rel="prefetch" href="/assets/21-记忆术基本功之逻辑联想法.html.0dbdbc34.js"><link rel="prefetch" href="/assets/22-记忆术基本功之逻辑推理记忆信息.html.8d754313.js"><link rel="prefetch" href="/assets/23-记忆术基本功之故事法.html.ef97f34d.js"><link rel="prefetch" href="/assets/24-记忆术基础训练抽象词汇串联.html.3d8ad373.js"><link rel="prefetch" href="/assets/25-记忆术之词性串联训练.html.4711a891.js"><link rel="prefetch" href="/assets/26-记忆术基本功之归纳简化.html.e6bdc38f.js"><link rel="prefetch" href="/assets/27-口诀记忆.html.aff4c244.js"><link rel="prefetch" href="/assets/28-绘图记忆法.html.a5d46859.js"><link rel="prefetch" href="/assets/29-比喻记忆法.html.8c3c7ffe.js"><link rel="prefetch" href="/assets/30-内视觉出图七要素.html.bb3211f6.js"><link rel="prefetch" href="/assets/31-创造和加工图像.html.2b4af3f0.js"><link rel="prefetch" href="/assets/32-万物皆桩.html.9543cf05.js"><link rel="prefetch" href="/assets/33-一对一联结训练.html.e2427b2b.js"><link rel="prefetch" href="/assets/34-记忆初级万能公式.html.79fb16b9.js"><link rel="prefetch" href="/assets/35-记忆术的两种核心技巧谐音和逻辑.html.0f854b87.js"><link rel="prefetch" href="/assets/36-关键词记忆法.html.b1d770a1.js"><link rel="prefetch" href="/assets/37-如何集中注意力.html.d0be9865.js"><link rel="prefetch" href="/assets/38-视觉化的窍门.html.8d364261.js"><link rel="prefetch" href="/assets/39-意群的逻辑图像转化.html.e31e4511.js"><link rel="prefetch" href="/assets/40-意群图像记忆的步骤.html.4250bbbf.js"><link rel="prefetch" href="/assets/41-文字编码库.html.4ded01b4.js"><link rel="prefetch" href="/assets/42-现实记忆宫殿.html.50304942.js"><link rel="prefetch" href="/assets/43-虚拟记忆宫殿.html.42bb5a3c.js"><link rel="prefetch" href="/assets/44-随机记忆宫殿.html.875b2c63.js"><link rel="prefetch" href="/assets/45-记忆宫殿之人物系统.html.54a9a8c7.js"><link rel="prefetch" href="/assets/46-五种方法记单词.html.286f13da.js"><link rel="prefetch" href="/assets/1简述一下你对线程池的理解.html.f2192bb4.js"><link rel="prefetch" href="/assets/2线程池如何知道一个线程的任务已经执 行完成.html.fe26d7a7.js"><link rel="prefetch" href="/assets/3Java 官方提供了哪几种线程池，分别有 什么特点？.html.38c44650.js"><link rel="prefetch" href="/assets/0怎么理解线程安全.html.27781d10.js"><link rel="prefetch" href="/assets/1ConcurrentHashMap 底层具体实现.html.2580c161.js"><link rel="prefetch" href="/assets/2谈一下 CAS 机制.html.ef22db2c.js"><link rel="prefetch" href="/assets/3谈谈 AQS 是怎么回事.html.af3bf30e.js"><link rel="prefetch" href="/assets/4ReentrantLock 是如何实现锁公平和非 公平性的.html.52ef7035.js"><link rel="prefetch" href="/assets/DCL 单例模式设计为什么需要 volatile 修饰实例对象.html.15201490.js"><link rel="prefetch" href="/assets/SimpleDateFormat 是线程安全的吗.html.74b5d1c4.js"><link rel="prefetch" href="/assets/wait 和 sleep 是否会触发锁的释放以及 CPU 资源的释放.html.d04a24f9.js"><link rel="prefetch" href="/assets/一个线程两次调用 start()，会出现什 么问题.html.345156de.js"><link rel="prefetch" href="/assets/404.html.a27f751c.js"><link rel="prefetch" href="/assets/index.html.ec1ae2ea.js"><link rel="prefetch" href="/assets/index.html.fbbd6da4.js"><link rel="prefetch" href="/assets/index.html.2bee8d7d.js"><link rel="prefetch" href="/assets/index.html.25224641.js"><link rel="prefetch" href="/assets/index.html.032347ba.js"><link rel="prefetch" href="/assets/index.html.3aeee098.js"><link rel="prefetch" href="/assets/index.html.9688f9ca.js"><link rel="prefetch" href="/assets/index.html.e8a2650a.js"><link rel="prefetch" href="/assets/index.html.9d5b36c5.js"><link rel="prefetch" href="/assets/index.html.4bafbcf4.js"><link rel="prefetch" href="/assets/index.html.13f15f72.js"><link rel="prefetch" href="/assets/index.html.3c02e928.js"><link rel="prefetch" href="/assets/index.html.0f058727.js"><link rel="prefetch" href="/assets/index.html.cc05f7a7.js"><link rel="prefetch" href="/assets/index.html.0991aadd.js"><link rel="prefetch" href="/assets/index.html.ab2a9d1c.js"><link rel="prefetch" href="/assets/index.html.bc5b6eb3.js"><link rel="prefetch" href="/assets/index.html.1d9be89d.js"><link rel="prefetch" href="/assets/index.html.0fd0c5c6.js"><link rel="prefetch" href="/assets/index.html.2766bdae.js"><link rel="prefetch" href="/assets/index.html.0d135fa5.js"><link rel="prefetch" href="/assets/index.html.866a42c6.js"><link rel="prefetch" href="/assets/index.html.af9400ba.js"><link rel="prefetch" href="/assets/index.html.ad944c4f.js"><link rel="prefetch" href="/assets/index.html.0988247e.js"><link rel="prefetch" href="/assets/index.html.b1901e06.js"><link rel="prefetch" href="/assets/index.html.44244dc1.js"><link rel="prefetch" href="/assets/index.html.ceeb04f2.js"><link rel="prefetch" href="/assets/index.html.e47f88eb.js"><link rel="prefetch" href="/assets/index.html.92756e53.js"><link rel="prefetch" href="/assets/index.html.8dfd9a94.js"><link rel="prefetch" href="/assets/index.html.b15ba957.js"><link rel="prefetch" href="/assets/index.html.51b95569.js"><link rel="prefetch" href="/assets/index.html.8f0c0ae5.js"><link rel="prefetch" href="/assets/index.html.94cd816b.js"><link rel="prefetch" href="/assets/index.html.f0264cc3.js"><link rel="prefetch" href="/assets/index.html.f0e0378b.js"><link rel="prefetch" href="/assets/404.ac39b40d.js"><link rel="prefetch" href="/assets/Layout.a93cddbb.js"><link rel="prefetch" href="/assets/Slide.b1311b31.js"><link rel="prefetch" href="/assets/Blog.50829e45.js"><link rel="prefetch" href="/assets/auto.esm.36809f22.js"><link rel="prefetch" href="/assets/index.308e684a.js"><link rel="prefetch" href="/assets/index.1842ee54.js"><link rel="prefetch" href="/assets/mermaid.esm.min.0cec5e87.js"><link rel="prefetch" href="/assets/highlight.esm.d982e650.js"><link rel="prefetch" href="/assets/markdown.esm.832a189d.js"><link rel="prefetch" href="/assets/math.esm.a3f84b6f.js"><link rel="prefetch" href="/assets/notes.esm.3c361cb7.js"><link rel="prefetch" href="/assets/reveal.esm.b96f05d8.js"><link rel="prefetch" href="/assets/search.esm.80da4a02.js"><link rel="prefetch" href="/assets/zoom.esm.8514a202.js"><link rel="prefetch" href="/assets/photoswipe.esm.92018b73.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/panda.gif" alt="Panda诚的博客"><!----><span class="site-name hide-in-pad">Panda诚的博客</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="Home"><span class="icon iconfont icon-home" style=""></span>Home<!----></a></div><div class="nav-item hide-in-mobile"><a href="/timeline/" class="nav-link" aria-label="时间轴"><span class="icon iconfont icon-date" style=""></span>时间轴<!----></a></div><div class="nav-item hide-in-mobile"><a href="/tag/" class="nav-link" aria-label="Tags"><span class="icon iconfont icon-tag" style=""></span>Tags<!----></a></div></nav><!----></div><div class="navbar-right"><!----><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://github.com/zhangchengk" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">🐼  数据库CDC</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">🐼  ApacheNIFI教程</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/000-ApacheNIFI%E5%8E%86%E5%8F%B2.html" class="nav-link sidebar-link sidebar-page" aria-label="NIFI简史"><!---->NIFI简史<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/001-NiFi%E6%9C%AF%E8%AF%AD.html" class="nav-link sidebar-link sidebar-page" aria-label="NIFI术语"><!---->NIFI术语<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/002-%E5%B8%A6%E4%BD%A0%E4%BD%93%E9%AA%8CApacheNIFI.html" class="nav-link sidebar-link sidebar-page" aria-label="带你体验Apache NIFI"><!---->带你体验Apache NIFI<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/003-NIFI%E5%85%A5%E9%97%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="NIFI读完即入门"><!---->NIFI读完即入门<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/004-%E6%95%B0%E6%8D%AE%E6%8A%BD%E5%8F%96%E7%9A%84%E5%B8%B8%E8%A7%81%E6%96%B9%E6%B3%95.html" class="nav-link sidebar-link sidebar-page" aria-label="数据抽取的常见理论方法"><!---->数据抽取的常见理论方法<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/005-%E5%9F%BA%E4%BA%8E%E5%A2%9E%E9%87%8F%E5%AD%97%E6%AE%B5%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE.html" class="nav-link sidebar-link sidebar-page" aria-label="基于增量字段同步数据"><!---->基于增量字段同步数据<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/006-NIFI%E5%90%84%E4%B8%AANAR%E5%8C%85%E5%8A%9F%E8%83%BD%E6%A6%82%E8%BF%B0.html" class="nav-link sidebar-link sidebar-page" aria-label="各个NAR包功能概述"><!---->各个NAR包功能概述<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/007-Nar%E5%8C%85%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB.html" class="nav-link sidebar-link sidebar-page" aria-label="Nar包加载机制源码解读"><!---->Nar包加载机制源码解读<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/008-Nar%E5%8C%85%E4%B8%8B%E7%9A%84MANIFEST.MF.html" class="nav-link sidebar-link sidebar-page" aria-label="Nar包下的MANIFEST.MF"><!---->Nar包下的MANIFEST.MF<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/009-Apache%20NIFI%E7%B1%BB%E8%B5%84%E6%BA%90%E9%9A%94%E7%A6%BB%E6%9C%BA%E5%88%B6.html" class="nav-link sidebar-link sidebar-page" aria-label="NIFI类资源隔离机制"><!---->NIFI类资源隔离机制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/010-Apache%20NIFI%20Processor%E6%83%85%E5%86%B5.html" class="nav-link sidebar-link sidebar-page" aria-label="Processor情况"><!---->Processor情况<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/011-%E7%90%86%E8%A7%A3connection.html" class="nav-link sidebar-link sidebar-page" aria-label="深入理解Connection"><!---->深入理解Connection<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/012-%E7%90%86%E8%A7%A3maxThread%E8%AE%BE%E7%BD%AE.html" class="nav-link sidebar-link sidebar-page" aria-label="最大线程池和处理器并发任务设置"><!---->最大线程池和处理器并发任务设置<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/013-RunDuration%E7%90%86%E8%A7%A3.html" class="nav-link sidebar-link sidebar-page" aria-label="Run Duration深入理解"><!---->Run Duration深入理解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/014-ContentRepositoryArchiving%E7%90%86%E8%A7%A3.html" class="nav-link sidebar-link sidebar-page" aria-label="ContentRepositoryArchiving工作原理(译)"><!---->ContentRepositoryArchiving工作原理(译)<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/015-Controller%20Services%E6%98%AF%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="Controller Services是守护进程"><!---->Controller Services是守护进程<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="深入解析调度策略"><!---->深入解析调度策略<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#nifi的调度策略" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="NIFI的调度策略"><!---->NIFI的调度策略<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#timer-driven" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Timer driven"><!---->Timer driven<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="疑问1"><!---->疑问1<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="疑问2"><!---->疑问2<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问3" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="疑问3"><!---->疑问3<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问4" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="疑问4"><!---->疑问4<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问5" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="疑问5"><!---->疑问5<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问6" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="疑问6"><!---->疑问6<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#cron-driven" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="CRON driven"><!---->CRON driven<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问1-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="疑问1"><!---->疑问1<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问2-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="疑问2"><!---->疑问2<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#event-driven" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Event driven"><!---->Event driven<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问1-2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="疑问1"><!---->疑问1<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#总结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="总结"><!---->总结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/017-NIFI%E9%AB%98%E5%8F%AF%E7%94%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="探索NIFI集群的高可用"><!---->探索NIFI集群的高可用<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/018-%E9%80%9A%E8%BF%87%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96NiFi%E6%80%A7%E8%83%BD.html" class="nav-link sidebar-link sidebar-page" aria-label="通过配置优化NiFi性能"><!---->通过配置优化NiFi性能<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/019-NIFI%E9%87%8C%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0.html" class="nav-link sidebar-link sidebar-page" aria-label="NIFI里的数据库连接池"><!---->NIFI里的数据库连接池<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/020-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8NIFI%E9%87%8C%E7%9A%84Record.html" class="nav-link sidebar-link sidebar-page" aria-label="建议使用NIFI里的Record"><!---->建议使用NIFI里的Record<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/021-NIFI%E8%B4%A1%E7%8C%AE%E4%BB%A3%E7%A0%81.html" class="nav-link sidebar-link sidebar-page" aria-label="如何给NIFI贡献代码"><!---->如何给NIFI贡献代码<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/022-NIFI%E5%BC%80%E5%90%AFHTTPS.html" class="nav-link sidebar-link sidebar-page" aria-label="NIFI开启HTTPS"><!---->NIFI开启HTTPS<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/023-ExecuteScript%E8%84%9A%E6%9C%AC%E6%95%99%E7%A8%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="ExecuteScript组件脚本使用教程"><!---->ExecuteScript组件脚本使用教程<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/024-%E5%86%85%E5%AE%B9%E5%AD%98%E5%82%A8%E5%BA%93%E5%8E%9F%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="内容存储库原理"><!---->内容存储库原理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/025-FlowFile%E5%AD%98%E5%82%A8%E5%BA%93%E5%8E%9F%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="FlowFile存储库原理"><!---->FlowFile存储库原理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/026-%E9%A2%84%E5%86%99%E6%97%A5%E5%BF%97(WAL).html" class="nav-link sidebar-link sidebar-page" aria-label="NiFi的Write-Ahead Log"><!---->NiFi的Write-Ahead Log<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/027-Provenance%E5%AD%98%E5%82%A8%E5%BA%93%E5%8E%9F%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="Provenance存储库原理"><!---->Provenance存储库原理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/028-NIFI%E6%9E%B6%E6%9E%84.html" class="nav-link sidebar-link sidebar-page" aria-label="NIFI架构"><!---->NIFI架构<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/029-NIFI%E4%BA%8B%E5%8A%A1%E5%8E%9F%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="NIFI事务原理"><!---->NIFI事务原理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/030-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="NiFi支持的读写数据库字段类型"><!---->NiFi支持的读写数据库字段类型<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/031-1.14.html" class="nav-link sidebar-link sidebar-page" aria-label="NIFI 1.14"><!---->NIFI 1.14<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/032-CaptureChangeMySQL.html" class="nav-link sidebar-link sidebar-page" aria-label="CaptureChangeMySQL"><!---->CaptureChangeMySQL<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/033-%E6%B5%81%E7%A8%8B%E5%91%8A%E8%AD%A6.html" class="nav-link sidebar-link sidebar-page" aria-label="NIFI流程微信告警"><!---->NIFI流程微信告警<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/034-JWT.html" class="nav-link sidebar-link sidebar-page" aria-label="Apache NiFi中的JWT身份验证"><!---->Apache NiFi中的JWT身份验证<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/037-MySQL%E5%85%A8%E5%AD%97%E6%AE%B5%E6%B5%8B%E8%AF%95.html" class="nav-link sidebar-link sidebar-page" aria-label="MySQL全字段读写测试(NIFI 1.15.3)"><!---->MySQL全字段读写测试(NIFI 1.15.3)<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">🐼  ApacheNIFI开发</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">🐼  Spring常见错误</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">🐼  IO流(java)</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">🐼  JAVA</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">🐼  JOLT</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->深入解析调度策略</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://zhangchengk.github.io/about/intro.html" target="_blank" rel="noopener noreferrer">Panda诚</a></span><span property="author" content="Panda诚"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2020年6月8日</span><meta property="datePublished" content="2020-06-08T00:00:00.000Z"></span><span class="category-info" aria-label="分类🌈" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li class="category category1 clickable" role="navigation">ApacheNIFI教程</li><meta property="articleSection" content="ApacheNIFI教程"></ul></span><span aria-label="标签🏷" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag2 clickable" role="navigation">NIFI</li></ul><meta property="keywords" content="NIFI"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 23 分钟</span><meta property="timeRequired" content="PT23M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#nifi的调度策略" class="router-link-active router-link-exact-active toc-link level2">NIFI的调度策略</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#timer-driven" class="router-link-active router-link-exact-active toc-link level2">Timer driven</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问1" class="router-link-active router-link-exact-active toc-link level3">疑问1</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问2" class="router-link-active router-link-exact-active toc-link level3">疑问2</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问3" class="router-link-active router-link-exact-active toc-link level3">疑问3</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问4" class="router-link-active router-link-exact-active toc-link level3">疑问4</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问5" class="router-link-active router-link-exact-active toc-link level3">疑问5</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问6" class="router-link-active router-link-exact-active toc-link level3">疑问6</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#cron-driven" class="router-link-active router-link-exact-active toc-link level2">CRON driven</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问1-1" class="router-link-active router-link-exact-active toc-link level3">疑问1</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问2-1" class="router-link-active router-link-exact-active toc-link level3">疑问2</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#event-driven" class="router-link-active router-link-exact-active toc-link level2">Event driven</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#疑问1-2" class="router-link-active router-link-exact-active toc-link level3">疑问1</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html#总结" class="router-link-active router-link-exact-active toc-link level2">总结</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><p>简介：本文主要讲解Apache NIFI的调度策略，对象主要是针对Processor组件。本文假定读者已经对Apache NIFI有了一定的了解和使用经验，同时作者也尽可能的去讲解的更透彻，使得本文尽可能让对NIFI接触不深的读者也能够看懂。</p><h2 id="nifi的调度策略" tabindex="-1"><a class="header-anchor" href="#nifi的调度策略" aria-hidden="true">#</a> NIFI的调度策略</h2><p>打开任意一个Processsor，在其配置页面SCHEDULING页签我们可以配置它的调度策略，如下图所示：</p><p><img src="/assets/1.c0ef3d49.png" alt="" loading="lazy"></p><p><img src="/assets/2.ca64a116.png" alt="" loading="lazy"></p><p>在流程中有一类的Processor的实例是不允许传入FlowFIle的，我们姑且可以称之为<code>流程源结点</code>(第一个节点)。这类Processor实例的调度策略只有两种，而其他的Processor实例的调度策略有三种。(注意，这里强调的是Processor实例，有些Processor在<code>源组件</code>位置时是两种调度策略，没有Event策略，而当这些Processor不处于<code>源组件</code>位置时，它会有三种调度策略)</p><ol><li><p><strong>Timer driven</strong>: 这是调度策略的默认模式。处理器会定期运行。处理器运行的时间间隔由<code>Run schedule</code>选项定义。</p></li><li><p><strong>Event driven</strong>: 如果选择此模式，则由event触发处理器运行，并且该event在FlowFiles进入到该处理器的上游Connection时发生。该模式当前被认为是实验性的，<code>并非所有处理器都支持</code>(Processor类使用@EventDriven注解标注的组件是支持Event driven的)。选择此模式后，<code>Run schedule</code>选项不可配置，因为不会触发处理器<code>定期</code>运行，而是由event触发。此外，这是可以将<code>Concurrent tasks</code>选项设置为0的唯一模式。在这种情况下，线程数仅受<code>Event-Driven Thread Pool</code>的大小限制。</p></li><li><p><strong>CRON driven</strong>: 当使用CRON驱动的调度模式时，处理器被调度为定期运行(比如每天凌晨调度运行)，<code>类似于计时器驱动的调度模式</code>，CRON驱动模式以增加配置复杂性为代价提供了更大的灵活性。 CRON驱动的调度值是由六个必填字段和一个可选字段组成的字符串，每个字段之间用空格分隔。</p></li></ol><p>好了，以上就是本文全部内容。</p><p>全剧终。。。</p><p>好吧，上面所述都是理论知识，在官方文档里都能看到，下面我们进一步对这些调度策略进行探索总结。</p><h2 id="timer-driven" tabindex="-1"><a class="header-anchor" href="#timer-driven" aria-hidden="true">#</a> Timer driven</h2><p><code>Timer driven</code>是我们最常用的调度策略了，简单易懂，<code>10 sec</code>就是每隔10秒调度一次。</p><p>可识别的后缀如下所示：</p><ul><li>纳秒：&quot;ns&quot;, &quot;nano&quot;, &quot;nanos&quot;, &quot;nanosecond&quot;, &quot;nanoseconds&quot;</li><li>毫秒：&quot;ms&quot;, &quot;milli&quot;, &quot;millis&quot;, &quot;millisecond&quot;, &quot;milliseconds&quot;</li><li>秒：&quot;s&quot;, &quot;sec&quot;, &quot;secs&quot;, &quot;second&quot;, &quot;seconds&quot;</li><li>分钟：&quot;m&quot;, &quot;min&quot;, &quot;mins&quot;, &quot;minute&quot;, &quot;minutes&quot;</li><li>小时：&quot;h&quot;, &quot;hr&quot;, &quot;hrs&quot;, &quot;hour&quot;, &quot;hours&quot;</li><li>天：&quot;d&quot;, &quot;day&quot;, &quot;days&quot;</li><li>周：&quot;w&quot;, &quot;wk&quot;, &quot;wks&quot;, &quot;week&quot;, &quot;weeks&quot;</li></ul><h3 id="疑问1" tabindex="-1"><a class="header-anchor" href="#疑问1" aria-hidden="true">#</a> 疑问1</h3><p><strong>那么第一个问题来了，比如说每隔10秒调度一次，是什么意思？是从0秒开始，10秒，20秒，30秒。。。这样的每次去执行调度嘛？还是每次任务结束后开始计时？</strong></p><p>下面我们来实际求证一下。</p><p>新拉取一个<code>ExecuteGroovyScript</code>组件，选择<code>Timer driven</code>并设置2秒运行一次，然后在<code>Script Body</code>配置中添加Groovy代码</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token comment">//创建一个流文件</span>
flowFile <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//添加一个属性，在FlowFIle中记录一个时间，姑且把这个时间当做本次调度开始时间</span>
flowFile <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">putAttribute</span><span class="token punctuation">(</span>flowFile<span class="token punctuation">,</span> <span class="token string">&#39;Time&#39;</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//然后休眠3秒</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
	Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>InterruptedException e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token comment">//将FlowFIle传输到success</span>
session<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>flowFile<span class="token punctuation">,</span> REL_SUCCESS<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>点击运行后生成了三个流文件</p><p><img src="/assets/3.de83f0cb.png" alt="" loading="lazy"></p><p>我们分别来看一下这3个流文件的<code>Time</code>属性</p><p><img src="/assets/4.a63b6c9b.png" alt="" loading="lazy"></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1591270393098
  +5141  大约是5秒
1591270398239
  +5012  大约是5秒
1591270403251
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>所以，结果显而易见了，这里是每次任务结束后开始计时(后面疑问5里会提到源码，源码里就是上一次任务结束后计时，时间一过，然后开始下次任务)。</p><h3 id="疑问2" tabindex="-1"><a class="header-anchor" href="#疑问2" aria-hidden="true">#</a> 疑问2</h3><p><strong>第二个问题 如果我们安排处理器每0秒运行一次（默认情况下），会发生什么？它会一直运行，消耗大量资源吗？</strong></p><p>答案显然是不会的！(如果这点都做不好，还搞啥子Apache顶级项目嘛)</p><p>在NIFI安装目录conf下的nifi.properties中有如下配置，队列中没有数据的时候也就是Processor没有可处理的数据，那么我们在这里配置隔多久再去调度<strong>检查</strong>一次组件是否有可做的有工作。</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># If a component has no work to do (is &quot;bored&quot;), how long should we wait before checking again for work?</span>
<span class="token key attr-name">nifi.bored.yield.duration</span><span class="token punctuation">=</span><span class="token value attr-value">10 millis</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>假如我们使用的是默认配置，那么意思是说虽然我们配置了处理器每0秒运行一次，但当Processor没有工作要做时(可以简单理解为上游Connection是空的)，它会等<code>10 millis</code>然后再调度一次<strong>检查组件</strong>是否有工作要做(在后面的疑问5里会有源码说明到这个10ms)。</p><h3 id="疑问3" tabindex="-1"><a class="header-anchor" href="#疑问3" aria-hidden="true">#</a> 疑问3</h3><p>看到这里使用过Apache NIFI的人可能会有疑问了，怎么会这样，我们在运行流程的时候，比如下图<code>UpdateAttribute</code>设置的每0秒运行一次，它的上游Connection是空的，<strong>我们观察它并没有被调度啊？</strong>(组件方块右上角根本没有显示任何数字)</p><p><img src="/assets/5.42bda55f.png" alt="" loading="lazy"></p><p>然后我们要明确一点，Processor右上角的那个数字的含义是<code>Active Tasks</code></p><p><img src="/assets/6.af060bc6.png" alt="" loading="lazy"></p><blockquote><p><code>Active Tasks</code>：<strong>该处理器</strong>当前正在执行的任务数(有几个任务在调用Processor的onTrigger方法)。此数字受Processor配置对话框的<code>Scheduling</code>选项卡中的<code>Concurrent tasks</code>设置约束。在这里，我们可以看到处理器当前正在执行一项任务。如果NiFi实例是集群的，则此值表示集群中所有节点上当前正在执行的任务数。</p></blockquote><p>额外说一些，那么显示出来的这个<code>Acrive Task</code>是怎么来的呢？首先在Apache NIFI中有一个对象<code>StandardProcessorNode</code>(可以简单这么理解，我们对于一个组件的调度、并发等等配置以及对这个组件的监控、跟踪等等信息都是存储在这个对象里，每个Processor实例都会对应一个StandardProcessorNode实例),ProcessorNode是线程安全的。在<code>StandardProcessorNode</code>中有这么这么几段代码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onTrigger</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">ProcessContext</span> context<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">ProcessSessionFactory</span> sessionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取ProcessorNode所指向的Processor</span>
        <span class="token keyword">final</span> <span class="token class-name">Processor</span> processor <span class="token operator">=</span> processorRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Active Task +1</span>
        <span class="token function">activateThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">NarCloseable</span> narCloseable <span class="token operator">=</span> <span class="token class-name">NarCloseable</span><span class="token punctuation">.</span><span class="token function">withComponentNarLoader</span><span class="token punctuation">(</span><span class="token function">getExtensionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> processor<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> processor<span class="token punctuation">.</span><span class="token function">getIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//这里调用的是Processor的onTrigger方法逻辑</span>
            processor<span class="token punctuation">.</span><span class="token function">onTrigger</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> sessionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment">//Active Task -1</span>
            <span class="token function">deactivateThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而<code>activateThread()</code>方法</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">,</span> <span class="token class-name">ActiveTask</span><span class="token punctuation">&gt;</span></span> activeThreads <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">activateThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">Long</span> timestamp <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        activeThreads<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>thread<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ActiveTask</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而在NIFI Web Api里，在生成一个Processor的状态信息时会调用<code>public synchronized List&lt;ActiveThreadInfo&gt; getActiveThreads()</code>方法，进而就能够获取到<code>Acrive Task</code>数值，这里就不展开源码说了，感兴趣的读者直接顺着上面说的方法查看调用就可以找到了。</p><p>那我们来手动证明一次，当Processor没有需要处理的数据时，不会触发Processor的onTrigger方法,我们复用上面的groovy组件，加一行打印日志的代码</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>
<span class="token comment">// 打印警告日志</span>
log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;我被调度了&#39;</span><span class="token punctuation">)</span>

<span class="token comment">//创建一个流文件</span>
flowFile <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//添加一个属性，在FlowFIle中记录一个时间，姑且把这个时间当做本次调度开始时间</span>
flowFile <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">putAttribute</span><span class="token punctuation">(</span>flowFile<span class="token punctuation">,</span> <span class="token string">&#39;Time&#39;</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//然后休眠3秒</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
	Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>InterruptedException e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token comment">//将FlowFIle传输到success</span>
session<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>flowFile<span class="token punctuation">,</span> REL_SUCCESS<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后在<code>ExecuteGroovyScript</code>上游添加一个组件<code>GenerateFlowFile</code>用于生成流文件。这是持续一段时间后的截图，我们观察组件右上角并没有日志输出表明这个组件的onTrigger并没有被调用</p><p><img src="/assets/7.f3b309d6.png" alt="" loading="lazy"></p><p>作为对比，我们发送一个流文件，就能观察到日志输出：</p><p><img src="/assets/8.8b5ebb9a.png" alt="" loading="lazy"></p><p>总结一下：我们配置了处理器每0秒运行一次，但当Processor没有工作要做时，它会等<code>10 millis</code>然后再<strong>检查</strong>一次是否有工作要做，是不会触发Processor运行任务的(不会调Processor的onTrigger方法)。</p><blockquote><p>这里我们说的比较清楚，Processor没有工作要做导致了没有Active Task(不会触发Processor的onTrigger方法)，而不是说没有线程运行或者没有调度发生。</p></blockquote><h3 id="疑问4" tabindex="-1"><a class="header-anchor" href="#疑问4" aria-hidden="true">#</a> 疑问4</h3><p><strong>那么怎么判断Processor是否有工作要做？</strong></p><p>首先我们看到，一个叫<code>ConnectableTask</code>的实例会去调用<code>StandardProcessorNode</code>的<code>onTrigger</code>方法，执行的地方叫<code>invoke()</code></p><p><img src="/assets/9.d524784c.png" alt="" loading="lazy"></p><p><img src="/assets/10.52599914.png" alt="" loading="lazy"></p><p>而调用<code>ConnectableTask</code>的<code>invoke()</code>方法的有两个agent：<code>QuartzSchedulingAgent</code>对应<strong>CRON driven</strong> <code>TimerDrivenSchedulingAgent</code>对应<strong>Timer driven</strong>。先不管agent,在<code>invoke()</code>方法会调用<code>isWorkToDo()</code>来判断这个组件实例是否有工作要做。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isWorkToDo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//Connectables意思是可以连接的组件，这里判断当前的connectable的所有上游的Connection是否都是来自于它自己</span>
        <span class="token keyword">boolean</span> hasNonLoopConnection <span class="token operator">=</span> <span class="token class-name">Connectables</span><span class="token punctuation">.</span><span class="token function">hasNonLoopConnection</span><span class="token punctuation">(</span>connectable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//对FUNNEL组件特殊处理 这里我们直接跳过不看</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>connectable<span class="token punctuation">.</span><span class="token function">getConnectableType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ConnectableType</span><span class="token punctuation">.</span>FUNNEL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Handle Funnel as a special case because it will never be a &#39;source&#39; component,</span>
            <span class="token comment">// and also its outgoing connections can not be terminated.</span>
            <span class="token comment">// Incoming FlowFiles from other components, and at least one outgoing connection are required.</span>
            <span class="token keyword">return</span> connectable<span class="token punctuation">.</span><span class="token function">hasIncomingConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token operator">&amp;&amp;</span> hasNonLoopConnection
                    <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>connectable<span class="token punctuation">.</span><span class="token function">getConnections</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token operator">&amp;&amp;</span> <span class="token class-name">Connectables</span><span class="token punctuation">.</span><span class="token function">flowFilesQueued</span><span class="token punctuation">(</span>connectable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 判断当前的组件是否是Source，也就是我们前面说的源组件。以下任意情况都可以说明此组件是源组件</span>
        <span class="token comment">// 1 当组件被TriggerWhenEmpty注解标注的时候(这个注解你可以理解为上游Connection没有FLowFIle也执行调度)</span>
        <span class="token comment">// 2 当组件上游没有Connection的时候(没有输入FlowFIle的Connection)</span>
        <span class="token comment">// 3 当组件上游的所有Connection都是来自于这个组件自己(自己连自己的一个循环)，没有来自其他组价的Connection</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> isSourceComponent <span class="token operator">=</span> connectable<span class="token punctuation">.</span><span class="token function">isTriggerWhenEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// No input connections</span>
                <span class="token operator">||</span> <span class="token operator">!</span>connectable<span class="token punctuation">.</span><span class="token function">hasIncomingConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// Every incoming connection loops back to itself, no inputs from other components</span>
                <span class="token operator">||</span> <span class="token operator">!</span>hasNonLoopConnection<span class="token punctuation">;</span>

        <span class="token comment">// 如果这个组件是源组件，那么系统认为它是有工作要做的，否则得看上游Connection是否有FlowFIle</span>
        <span class="token keyword">return</span> isSourceComponent <span class="token operator">||</span> <span class="token class-name">Connectables</span><span class="token punctuation">.</span><span class="token function">flowFilesQueued</span><span class="token punctuation">(</span>connectable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><code>ConnectableTask</code>的<code>invoke()</code>方法经过一系列验证如果判断可以运行，那么后面会有一行<code>connectable.onTrigger(processContext, activeSessionFactory);</code>，就是调用Processor.onTrigger的入口。</p></blockquote><p>总结一下，在<code>Time drven</code>策略下(也包括<code>CRON driven</code>)，在触发组件的onTrigger方法之前会先判断这个这个组件是否有工作要做，判断结果为true才会继续运行下去，进而调用Processor的onTrigger方法。</p><h3 id="疑问5" tabindex="-1"><a class="header-anchor" href="#疑问5" aria-hidden="true">#</a> 疑问5</h3><p>在<a href="/ApacheNIFI%E6%95%99%E7%A8%8B/%E7%90%86%E8%A7%A3maxThread%E8%AE%BE%E7%BD%AE.html" class="">理解maxThread设置</a>一文中介绍了<code>最大计时器线程计数(Max Timer Driven Thread Count)</code>，那么问题是：<strong>在上面所述，我们检测到组件没有工作要做，在检测的时候它占用了线程池里的线程嘛？</strong></p><p>先说结论，检测当前组件是否有工作可做的行为是线程池分配一个线程来执行这次调度的一部分，是在调度最前面执行的逻辑，如果判断没有工作可做，那么就不用继续往下执行了，本次调度就结束了(本次调度不执行Processor的onTrigger方法)，这个动作是<strong>很快很快很快</strong>的。也就是说检测是否有工作可做的时候，是要占用一个<code>最大计时器线程计数(Max Timer Driven Thread Count)</code>里的线程的。咋一听，不太合理啊。我就配置了这么多数量的线程池，你不干活还得占用我的一个线程。。。然而事实如此，下面我们分别从源码和动手验证来看一下：</p><p>首先NIFI继承<code>ScheduledThreadPoolExecutor</code>自定义了一个线程池FlowEngine(Timer Drriven和CRON Driven对应的是同一个线程池-&gt;FlowEngine实例，而Event Driven对应的是另一个线程池-&gt;FlowEngine实例)，</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">FlowEngine</span> <span class="token keyword">extends</span> <span class="token class-name">ScheduledThreadPoolExecutor</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>关于ScheduledThreadPoolExecutor这里简单说一下，ScheduledThreadPoolExecutor继承了ThreadPoolExecutor，也就是说ScheduledThreadPoolExecutor拥有execute()和submit()提交异步任务的基础功能,它的构造方法实际上是调用了ThreadPoolExecutor,ScheduledThreadPoolExecutor实现了ScheduledExecutorService接口，该接口定义了可延时执行异步任务和可周期执行异步任务的特有功能.而延时执行异步任务和周期执行异步任务分别就是Apache NIFI <code>CRON driven</code>和<code>Timer driven</code>策略的实现核心所在。</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//达到给定的延时时间后，执行任务。这里传入的是实现Runnable接口的任务，</span>
<span class="token comment">//因此通过ScheduledFuture.get()获取结果为null</span>
<span class="token keyword">public</span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">,</span>
                                       <span class="token keyword">long</span> delay<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//达到给定的延时时间后，执行任务。这里传入的是实现Callable接口的任务，</span>
<span class="token comment">//因此，返回的是任务的最终计算结果</span>
 <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> callable<span class="token punctuation">,</span>
                                           <span class="token keyword">long</span> delay<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//是以上一个任务开始的时间计时，period时间过去后，</span>
<span class="token comment">//检测上一个任务是否执行完毕，如果上一个任务执行完毕，</span>
<span class="token comment">//则当前任务立即执行，如果上一个任务没有执行完毕，则需要等上一个任务执行完毕后立即执行</span>
<span class="token keyword">public</span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">,</span>
                                                  <span class="token keyword">long</span> initialDelay<span class="token punctuation">,</span>
                                                  <span class="token keyword">long</span> period<span class="token punctuation">,</span>
                                                  <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//当达到延时时间initialDelay后，任务开始执行。上一个任务执行结束后到下一次</span>
<span class="token comment">//任务执行，中间延时时间间隔为delay。以这种方式，周期性执行任务。</span>
<span class="token keyword">public</span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">scheduleWithFixedDelay</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">,</span>
                                                     <span class="token keyword">long</span> initialDelay<span class="token punctuation">,</span>
                                                     <span class="token keyword">long</span> delay<span class="token punctuation">,</span>
                                                     <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上是ScheduledThreadPoolExecutor执行延时和周期任务的方法，而在前面提到的<code>TimerDrivenSchedulingAgent</code>就会调用<code>flowEngine.scheduleWithFixedDelay</code>方法来周期的执行任务(对应疑问1每次任务执行完后再计时)。</p><p><code>TimerDrivenSchedulingAgent</code>类：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSchedule</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Connectable</span> connectable<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">LifecycleState</span> scheduleState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ScheduledFuture</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> futures <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">ConnectableTask</span> connectableTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectableTask</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> connectable<span class="token punctuation">,</span> flowController<span class="token punctuation">,</span> contextFactory<span class="token punctuation">,</span> scheduleState<span class="token punctuation">,</span> encryptor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> connectable<span class="token punctuation">.</span><span class="token function">getMaxConcurrentTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 确定要运行的任务并创建它。</span>
            <span class="token keyword">final</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ScheduledFuture</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> futureRef <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">final</span> <span class="token class-name">Runnable</span> trigger <span class="token operator">=</span> <span class="token function">createTrigger</span><span class="token punctuation">(</span>connectableTask<span class="token punctuation">,</span> scheduleState<span class="token punctuation">,</span> futureRef<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 周期性的去执行这个trigger</span>
            <span class="token keyword">final</span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> flowEngine<span class="token punctuation">.</span><span class="token function">scheduleWithFixedDelay</span><span class="token punctuation">(</span>trigger<span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">,</span>
                connectable<span class="token punctuation">.</span><span class="token function">getSchedulingPeriod</span><span class="token punctuation">(</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>NANOSECONDS<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>NANOSECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// now that we have the future, set the atomic reference so that if the component is yielded we</span>
            <span class="token comment">// are able to then cancel this future.</span>
            futureRef<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>future<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Keep track of the futures so that we can update the ScheduleState.</span>
            futures<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>future<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        scheduleState<span class="token punctuation">.</span><span class="token function">setFutures</span><span class="token punctuation">(</span>futures<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Scheduled {} to run with {} threads&quot;</span><span class="token punctuation">,</span> connectable<span class="token punctuation">,</span> connectable<span class="token punctuation">.</span><span class="token function">getMaxConcurrentTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后重点看上面代码<code>createTrigger(connectableTask, scheduleState, futureRef)</code>的实现：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Runnable</span> <span class="token function">createTrigger</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">ConnectableTask</span> connectableTask<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">LifecycleState</span> scheduleState<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ScheduledFuture</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> futureRef<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">Connectable</span> connectable <span class="token operator">=</span> connectableTask<span class="token punctuation">.</span><span class="token function">getConnectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">Runnable</span> yieldDetectionRunnable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 调用上面说的connectableTask的invoke方法(上面提到过，这里会判断组件是否有工作要做等等逻辑)</span>
                <span class="token keyword">final</span> <span class="token class-name">InvocationResult</span> invocationResult <span class="token operator">=</span> connectableTask<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>invocationResult<span class="token punctuation">.</span><span class="token function">isYield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Yielding {} due to {}&quot;</span><span class="token punctuation">,</span> connectable<span class="token punctuation">,</span> invocationResult<span class="token punctuation">.</span><span class="token function">getYieldExplanation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// 如果组件yielded, 则取消任务重新提交，然后过了yield时间再运行。</span>
                <span class="token comment">//(这里说的yield有两种，一种是因为组件异常，一种是因为没有工作可做，我们重点关注第二种)</span>
                <span class="token keyword">final</span> <span class="token keyword">long</span> newYieldExpiration <span class="token operator">=</span> connectable<span class="token punctuation">.</span><span class="token function">getYieldExpiration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">final</span> <span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//组件处理数据发生异常(指没有被捕获已处理的那些)时，组件会被惩罚一段时间不再被调度。显然没有工作可做的组件不是这种情况</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>newYieldExpiration <span class="token operator">&gt;</span> now<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                <span class="token punctuation">}</span> <span class="token comment">//noWorkYieldNanos就是上面疑问2说的10ms</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>noWorkYieldNanos <span class="token operator">&gt;</span> <span class="token number">0L</span> <span class="token operator">&amp;&amp;</span> invocationResult<span class="token punctuation">.</span><span class="token function">isYield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// Component itself didn&#39;t yield but there was no work to do, so the framework will choose</span>
                    <span class="token comment">// to yield the component automatically for a short period of time.</span>
                    <span class="token keyword">final</span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> scheduledFuture <span class="token operator">=</span> futureRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>scheduledFuture <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>scheduledFuture<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>scheduleState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>scheduleState<span class="token punctuation">.</span><span class="token function">isScheduled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token comment">//设置延迟10ms再调度一次</span>
                                <span class="token keyword">final</span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> newFuture <span class="token operator">=</span> flowEngine<span class="token punctuation">.</span><span class="token function">scheduleWithFixedDelay</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> noWorkYieldNanos<span class="token punctuation">,</span>
                                    connectable<span class="token punctuation">.</span><span class="token function">getSchedulingPeriod</span><span class="token punctuation">(</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>NANOSECONDS<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>NANOSECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                scheduleState<span class="token punctuation">.</span><span class="token function">replaceFuture</span><span class="token punctuation">(</span>scheduledFuture<span class="token punctuation">,</span> newFuture<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                futureRef<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>newFuture<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> yieldDetectionRunnable<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>动手验证的思路很简单，我们在NIFI上有一些正在运行但没有处理数据的Processor(没有active task)，然后修改一些代码使得能够我们查出来这个TimeDriven的FlowEngine线程池里大概正在运行的线程数，如果为0，那么说明<code>检测</code>组件有没有工作这个动作是不占线程池资源，如果不为0，那就是印证了上面我们分析源码得到的结论，占用线程池的资源。</p><p>在NIFI中我们设置有且只有4个正在运行的但不处理数据的Processor，如图：</p><p><img src="/assets/11.b28f0efc.png" alt="" loading="lazy"></p><p>按照下面四个步骤修改一下代码：</p><ol><li>我们需要添加一个Rest接口帮助我们查询线程池正在运行的大概的线程数，<code>ControllerResource</code>类增加</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@GET</span>
    <span class="token annotation punctuation">@Consumes</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>WILDCARD<span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Produces</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Path</span><span class="token punctuation">(</span><span class="token string">&quot;activeThreads&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getActiveThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> flowController<span class="token punctuation">.</span>timerDrivenEngineRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActiveCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>将<code>ApplicationResource</code>中的flowController修改成public</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">FlowController</span> flowController<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>将<code>FlowController</code>中的timerDrivenEngineRef修改成public</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FlowEngine</span><span class="token punctuation">&gt;</span></span> timerDrivenEngineRef<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="4"><li>防止线程运行太快，我们查不到正在运行的线程，我们在<code>TimerDrivenSchedulingAgent</code>类中处理没有工作可做时的逻辑中添加Thread.sleep代码</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>noWorkYieldNanos <span class="token operator">&gt;</span> <span class="token number">0L</span> <span class="token operator">&amp;&amp;</span> invocationResult<span class="token punctuation">.</span><span class="token function">isYield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;当前组件没有工作可以做，进入当前处理逻辑，防止处理太快我们查不到正在运行的线程，我们睡眠2秒&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">// Component itself didn&#39;t yield but there was no work to do, so the framework will choose</span>
                    <span class="token comment">// to yield the component automatically for a short period of time.</span>
                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编译后运行日志截图如下:</p><p><img src="/assets/13.1100886c.png" alt="" loading="lazy"></p><p>使用PostMan做Get请求结果如图：</p><p><img src="/assets/14.b973f64f.png" alt="" loading="lazy"></p><p>如果我们不按第四步修改代码，日志会很快很快的打印<code>当前组件没有工作可以做，进入当前处理逻辑，防止处理太快我们查不到正在运行的线程，我们睡眠2秒</code>,并且我们通过Rest接口查询的结果通常就是0</p><p><img src="/assets/12.fe4b1b83.png" alt="" loading="lazy"></p><p>源码分析与动手验证都证实了我们之前的结论，当这个组件启动但是没有处理数据，检测这个组件有没有工作可做也是占用线程池的一部分资源的。</p><blockquote><p>额外说一点，基于此疑问及得出的结论，我们应该知道，在NIFI中那些不再被使用到的流程和组件应该及时关闭或者清理掉。蚂蚁再小也是肉，积累多了也是会占用我们的资源的,也是基于这个原因，官方试图通过新的Event Driven策略来弥补这些不足。</p></blockquote><h3 id="疑问6" tabindex="-1"><a class="header-anchor" href="#疑问6" aria-hidden="true">#</a> 疑问6</h3><p>如果组件周期运行不是<code>0 sec</code>，我们假设是<code>1000 sec</code>，那么<code>检测</code>组件是否有工作的动作的频率还是10ms嘛？</p><p>从上面提到的源码分析，首先调度周期时间是由上一次任务运行完毕后再开始计时(调度周期偏向于FlowFIle之间流向组件的间隔)，并且在检测组件没有工作要做后的再注册的initialDelay还是10ms，那么<code>检测</code>组件是否有工作的动作的频率应该还是10ms。</p><p>动手验证很简单，基于疑问5搭建的验证场景，我们将四个运行的组件变成一个，这个组件运行的周期设置为<code>1000 sec</code>。然后我们观察日志，如果日志输出的多条日志之间是1000多秒，那么证明我们上面说的结论是错误的，如果日志之间是2秒多，那么说明<code>检测</code>组件是否有工作的动作的频率应该还是10ms。</p><p><img src="/assets/15.5ec97566.png" alt="" loading="lazy"></p><p><img src="/assets/16.c039e0f1.png" alt="" loading="lazy"></p><p>总结一下：检测组件是否有工作的动作的周期是与组件配置的周期时间无关的，默认的就是10ms</p><h2 id="cron-driven" tabindex="-1"><a class="header-anchor" href="#cron-driven" aria-hidden="true">#</a> CRON driven</h2><p>在技术实现上，它会先计算CRON表达式，得出现在的时间到定义的CRON下一次运行的时间点的时间差，然后调用的实质是Java<code>ScheduledThreadPoolExecutor</code>本身提供的延时执行策略。</p><p>CRON driven和Timer driven使用的同一个FlowEngine线程池，同时受<code>最大计时器线程计数(Max Timer Driven Thread Count)</code>控制。</p><p>CRON driven的调度配置是由六个必填字段和一个可选字段组成的字符串，每个字段之间用空格分隔。这些字段是：</p><table><thead><tr><th>Field</th><th>Valid values</th></tr></thead><tbody><tr><td>Seconds</td><td>0-59</td></tr><tr><td>Minutes</td><td>0-59</td></tr><tr><td>Hours</td><td>0-23</td></tr><tr><td>Day of Month</td><td>1-31</td></tr><tr><td>Month</td><td>1-12 or JAN-DEC</td></tr><tr><td>Day of Week</td><td>1-7 or SUN-SAT</td></tr><tr><td>Year (optional)</td><td>empty, 1970-2099</td></tr></tbody></table><p>通常，我们可以通过以下方式指定值：</p><ul><li><p><strong>Number</strong>: 指定一个或多个有效值。可以使用逗号分隔的列表输入多个值。</p></li><li><p><strong>Range</strong>: 使用<code>&lt;number&gt;-&lt;number&gt;</code>语法指定范围。</p></li><li><p><strong>Increment</strong>: 使用<code>&lt;start value&gt; /&lt;increment&gt;</code>语法指定一个增量。 比如, 配置Minutes, 0/15 表示 0, 15, 30, 45.</p></li></ul><p>我们还应该注意几个有效的特殊字符：</p><ul><li><p>*  — 指示所有值对该字段均有效。</p></li><li><p>?  — 表示未指定特定值。该特殊字符在<code>Day of Month</code>和<code>Day of Week</code>字段中有效。</p></li><li><p>L  — 可以将L附加到<code>Day of Week</code>值后面，以指定该天是本月的最后一次出现。例如，1L表示该月的最后一个星期日。</p></li></ul><p>比如:</p><ul><li><p><code>0 0 13 * * ?</code> 每天下午一点执行</p></li><li><p><code>0 20 14 ? * MON-FRI</code> 周一到周五每天下午2:20执行</p></li><li><p><code>0 15 10 ? * 6L 2011-2017</code> 2011年到2017年每月最后一个星期五上午10:15执行。</p></li></ul><h3 id="疑问1-1" tabindex="-1"><a class="header-anchor" href="#疑问1-1" aria-hidden="true">#</a> 疑问1</h3><p>基于上面的动手实验，如果中间的一个<code>UpdateAttribute</code>设置的是CRON driven，那么上面所说的<code>检测</code>组件是否有工作要做的动作还是每10ms一次嘛？</p><p>这里澄清一点，这个疑问本身就是错的。本组件是CRON策略，时间到了某时某刻，启动调度，如果有数据处理(或者是生成数据、拉取数据)就运行，如果没有工作要做，那就结束，等待下一次调度(比如等到明天的某时某刻再执行)。所以CRON driven就没有10ms周期检测组件是否有工作要处理这个动作。</p><h3 id="疑问2-1" tabindex="-1"><a class="header-anchor" href="#疑问2-1" aria-hidden="true">#</a> 疑问2</h3><p>使用CRON策略，比如我们设置的是<code>0 0/10 * * * ?</code>每小时中0、10分钟、20分钟、30分钟、40分钟、50分钟时间执行，然后如果到了10分钟时去调度，但是上一次执行还没有结束怎么办？</p><p>我们看一下<code>QuartzSchedulingAgent</code>类中的doSchedule方法(start一个Processor就会调用这个方法)</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">doSchedule</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Connectable</span> connectable<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">LifecycleState</span> scheduleState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AtomicBoolean</span><span class="token punctuation">&gt;</span></span> existingTriggers <span class="token operator">=</span> canceledTriggers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>connectable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>existingTriggers <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot schedule &quot;</span> <span class="token operator">+</span> connectable <span class="token operator">+</span> <span class="token string">&quot; because it is already scheduled to run&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//解析CRON表达式</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> cronSchedule <span class="token operator">=</span> connectable<span class="token punctuation">.</span><span class="token function">getSchedulingPeriod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">CronExpression</span> cronExpression<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            cronExpression <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CronExpression</span><span class="token punctuation">(</span>cronSchedule<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Exception</span> pe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot schedule &quot;</span> <span class="token operator">+</span> connectable <span class="token operator">+</span> <span class="token string">&quot; to run because its scheduling period is not valid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AtomicBoolean</span><span class="token punctuation">&gt;</span></span> triggers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 根据`Concurrent tasks`的配置，循环注册任务</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> connectable<span class="token punctuation">.</span><span class="token function">getMaxConcurrentTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">ConnectableTask</span> continuallyRunTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectableTask</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> connectable<span class="token punctuation">,</span> flowController<span class="token punctuation">,</span> contextFactory<span class="token punctuation">,</span> scheduleState<span class="token punctuation">,</span> encryptor<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">final</span> <span class="token class-name">AtomicBoolean</span> canceled <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//计算下一次CRON指定的时间点</span>
            <span class="token keyword">final</span> <span class="token class-name">Date</span> initialDate <span class="token operator">=</span> cronExpression<span class="token punctuation">.</span><span class="token function">getTimeAfter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//计算现在的时间点到下一次CRON指定执行的时间点的时间差</span>
            <span class="token keyword">final</span> <span class="token keyword">long</span> initialDelay <span class="token operator">=</span> initialDate<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">final</span> <span class="token class-name">Runnable</span> command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">private</span> <span class="token class-name">Date</span> nextSchedule <span class="token operator">=</span> initialDate<span class="token punctuation">;</span>
                <span class="token comment">//达到这个时间点，虚拟机会运行run方法</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>canceled<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token comment">//这里是上面提过的ConnectableTask的invoke方法，如果应该运行，就会调用Processor的onTrigger方法</span>
                        continuallyRunTask<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">RuntimeException</span> re<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">throw</span> re<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ProcessException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>canceled<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">//本次调度的主要工作做完了之后，再注册下一次延迟执行</span>
                    <span class="token comment">//计算下一次任务执行的延时时间</span>
                    nextSchedule <span class="token operator">=</span> <span class="token function">getNextSchedule</span><span class="token punctuation">(</span>nextSchedule<span class="token punctuation">,</span> cronExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">final</span> <span class="token keyword">long</span> delay <span class="token operator">=</span> <span class="token function">getDelay</span><span class="token punctuation">(</span>nextSchedule<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Finished task for {}; next scheduled time is at {} after a delay of {} milliseconds&quot;</span><span class="token punctuation">,</span> connectable<span class="token punctuation">,</span> nextSchedule<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//注册下一次延时执行的任务</span>
                    flowEngine<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> delay<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">//注册首次的延迟执行任务</span>
            flowEngine<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> initialDelay<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            triggers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>canceled<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        canceledTriggers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>connectable<span class="token punctuation">,</span> triggers<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Scheduled {} to run with {} threads on schedule {}&quot;</span><span class="token punctuation">,</span> connectable<span class="token punctuation">,</span> connectable<span class="token punctuation">.</span><span class="token function">getMaxConcurrentTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cronSchedule<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重要的是看一下<code>getNextSchedule</code>这个方法，</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Date</span> <span class="token function">getNextSchedule</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Date</span> currentSchedule<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">CronExpression</span> cronExpression<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 由于时钟的精度不是毫秒级，因此我们必须检查是否安排了应该在该时间之后运行的下一个时间，否则我们可能最终会运行两次相同的任务</span>
        <span class="token keyword">final</span> <span class="token class-name">Date</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cronExpression<span class="token punctuation">.</span><span class="token function">getTimeAfter</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>currentSchedule<span class="token punctuation">)</span> <span class="token operator">?</span> now <span class="token operator">:</span> currentSchedule<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由上面源码我们来分析，比如我们设置的是<code>0 0/10 * * * ?</code>每小时中0、10分钟、20分钟、30分钟、40分钟、50分钟时间执行，然后第0分钟运行了一个任务，它执行了15分钟，在它做完所有工作后其实计算的是到第20分钟这个时间点的延迟时间。</p><p>手动验证一下，设置<code>0/5 * * * * ?</code>，每分钟每0秒、0+5...执行一次，复用上面的groovy代码。</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code>
<span class="token comment">// 打印警告日志</span>
log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;我被调度了，本次调度发生时间为&#39;</span><span class="token operator">+</span>String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//创建一个流文件</span>
flowFile <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//添加一个属性，在FlowFIle中记录一个时间，姑且把这个时间当做本次调度开始时间</span>
flowFile <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">putAttribute</span><span class="token punctuation">(</span>flowFile<span class="token punctuation">,</span> <span class="token string">&#39;Time&#39;</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//然后休眠10秒</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
	Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>InterruptedException e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token comment">//将FlowFIle传输到success</span>
session<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>flowFile<span class="token punctuation">,</span> REL_SUCCESS<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/19.e7b28e34.png" alt="" loading="lazy"></p><p>我们得到4个流文件，一下依次是每个流文件的Time属性值</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1591608805094
    + 15秒
1591608820004
    + 15秒
1591608835002
    + 15秒
1591608850005
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第0秒第一次调度，如果执行的很快，那么第5秒应该执行第二次调度。但是第一次调度需要处理的数据很多，处理了10秒才完成任务，这个时候已经过了第5秒、第10秒这两个时间点，所以计算延迟时间使用的是第15秒这个时间点。而最终我们看到的各个流文件Time这个值的间隔是15秒，而不是5秒。</p><h2 id="event-driven" tabindex="-1"><a class="header-anchor" href="#event-driven" aria-hidden="true">#</a> Event driven</h2><p>如果选择此模式，则由event触发处理器运行，并且该event在FlowFiles进入到该处理器上游Connection时发生。该模式当前被认为是实验性的，<code>并非所有处理器都支持</code>(Processor类使用@EventDriven注解标注的Processor都支持Event driven)。选择此模式后，<code>Run schedule</code>选项不可配置，因为不会触发处理器<code>定期</code>运行，而是由event触发。此外，这是可以将<code>Concurrent tasks</code>选项设置为0的唯一模式。在这种情况下，线程数仅受<code>Event-Driven Thread Pool</code>的大小限制。</p><h3 id="疑问1-2" tabindex="-1"><a class="header-anchor" href="#疑问1-2" aria-hidden="true">#</a> 疑问1</h3><p><code>Concurrent tasks</code>配置还有效果嘛？</p><p>如果我们选择了<code>Event driven</code>，我们会看到<code>Concurrent tasks</code>的默认值变成了0.这里我们测试配置<code>Concurrent tasks</code>为2会不会生效。</p><p><img src="/assets/17.b6910e53.png" alt="" loading="lazy"></p><p><img src="/assets/18.3a4af471.png" alt="" loading="lazy"></p><p>我们看到<code>Concurrent tasks</code>配置成2是有效的。</p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>Apache NIFI 内部对组件的调用提供了三种调度策略：Timer driven，CRON driven，Event driven。</p><p>其中我们日常使用的是Timer driven，CRON driven。他们共同使用一个线程池，共同受<code>最大计时器线程计数(Max Timer Driven Thread Count)</code>限制。</p><p>Timer driven本质是使用<code>ScheduledThreadPoolExecutor</code>的周期执行任务，CRON driven本质是使用<code>ScheduledThreadPoolExecutor</code>延时执行任务。</p><p>Event driven是实验性质的，目前也并不是所有的组件都支持，不建议使用，但我们应该知道，Event driven的想法是更好的，效率和资源使用是更优的，后期我们可以期待一下它的完成情况(当然也有可能完不成)</p><p>以上并没有说明为什么Timer driven和CRON driven使用的是同一个线程池，这里简单说明一下，在<code>FlowController</code>构造函数里，quartzSchedulingAgent和timerDrivenAgent使用的是同一个FlowEngine实例</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token class-name">QuartzSchedulingAgent</span> quartzSchedulingAgent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QuartzSchedulingAgent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> timerDrivenEngineRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> repositoryContextFactory<span class="token punctuation">,</span> encryptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">TimerDrivenSchedulingAgent</span> timerDrivenAgent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TimerDrivenSchedulingAgent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> timerDrivenEngineRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> repositoryContextFactory<span class="token punctuation">,</span> encryptor<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nifiProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/zhangchengk/edit/main/demo/src/ApacheNIFI教程/016-NIFI调度.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/5/31 14:27:10</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: zhangchengk@foxmail.com">zhangcheng</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/015-Controller%20Services%E6%98%AF%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B.html" class="nav-link prev" aria-label="Controller Services是守护进程"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->Controller Services是守护进程</div></a><a href="/ApacheNIFI%E6%95%99%E7%A8%8B/017-NIFI%E9%AB%98%E5%8F%AF%E7%94%A8.html" class="nav-link next" aria-label="探索NIFI集群的高可用"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">探索NIFI集群的高可用<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">读书又笔记</div><div class="copyright">Copyright © 2024 Panda诚</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.17aaeba5.js" defer></script>
  </body>
</html>
