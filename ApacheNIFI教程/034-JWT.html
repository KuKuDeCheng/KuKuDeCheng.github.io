<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.50" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://zhangchengk.github.io/ApacheNIFI%E6%95%99%E7%A8%8B/034-JWT.html"><meta property="og:site_name" content="Panda诚的博客"><meta property="og:title" content="Apache NiFi中的JWT身份验证"><meta property="og:description" content="大部分文章译自原文：https://exceptionfactory.com/posts/2021/10/23/improving-jwt-authentication-in-apache-nifi/ 同时结合译文，参照NIFI(1.15)源码进行分析讲述举例说明 本文目的 深入对Apache NiFi的新版JWT身份验证深入理解。 为自定义外部应用程..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-06-27T13:31:00.000Z"><meta property="article:author" content="张诚"><meta property="article:tag" content="NIFI"><meta property="article:published_time" content="2022-01-19T00:00:00.000Z"><meta property="article:modified_time" content="2024-06-27T13:31:00.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Apache NiFi中的JWT身份验证","image":[""],"datePublished":"2022-01-19T00:00:00.000Z","dateModified":"2024-06-27T13:31:00.000Z","author":[{"@type":"Person","name":"张诚"}]}</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2410206_mfj6e1vbwo.css"><meta name="referrer" content="no-referrer"><link rel="icon" href="/logo.png"><title>Apache NiFi中的JWT身份验证 | Panda诚的博客</title><meta name="description" content="大部分文章译自原文：https://exceptionfactory.com/posts/2021/10/23/improving-jwt-authentication-in-apache-nifi/ 同时结合译文，参照NIFI(1.15)源码进行分析讲述举例说明 本文目的 深入对Apache NiFi的新版JWT身份验证深入理解。 为自定义外部应用程...">
    <link rel="preload" href="/assets/style-C1M8s3dk.css" as="style"><link rel="stylesheet" href="/assets/style-C1M8s3dk.css">
    <link rel="modulepreload" href="/assets/app-DiO1FYyc.js"><link rel="modulepreload" href="/assets/034-JWT.html-C5n6avzS.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-CiodhSio.js" as="script"><link rel="prefetch" href="/assets/001-编译NIFI源码.html-DJkgYTD7.js" as="script"><link rel="prefetch" href="/assets/002-NIFI自定义开发规范.html-kyJHo0p0.js" as="script"><link rel="prefetch" href="/assets/003-Processor的一些方法.html-Dkv9CJaU.js" as="script"><link rel="prefetch" href="/assets/004-自定义Processor.html-CcXM_4U4.js" as="script"><link rel="prefetch" href="/assets/005-自定义ExpressionLanguage.html-qZBjKx6N.js" as="script"><link rel="prefetch" href="/assets/006-NIFI启动源码.html-dDanqU4u.js" as="script"><link rel="prefetch" href="/assets/007-在HTTP模式下开启权限模块.html-D7URg3fO.js" as="script"><link rel="prefetch" href="/assets/008-JettyServer源码.html-NpQygxVk.js" as="script"><link rel="prefetch" href="/assets/009-NiFi源码.html-BxjV3c4X.js" as="script"><link rel="prefetch" href="/assets/010-nifi注解.html-C2YAlcL8.js" as="script"><link rel="prefetch" href="/assets/011-Debezium详细嵌入NIFI.html-BOcsg9Ke.js" as="script"><link rel="prefetch" href="/assets/RunNiFi源码.html-DUf2xVeD.js" as="script"><link rel="prefetch" href="/assets/nifi-env-sh.html-CZI2jAK4.js" as="script"><link rel="prefetch" href="/assets/nifi-sh-start.html-CJdcqia4.js" as="script"><link rel="prefetch" href="/assets/nifi-sh.html-MQ0c0bDa.js" as="script"><link rel="prefetch" href="/assets/000-ApacheNIFI历史.html-BjZfEzr4.js" as="script"><link rel="prefetch" href="/assets/001-NiFi术语.html-6rUaLIMY.js" as="script"><link rel="prefetch" href="/assets/002-带你体验ApacheNIFI.html-DhhGsfvS.js" as="script"><link rel="prefetch" href="/assets/003-NIFI入门.html-ja-52HLf.js" as="script"><link rel="prefetch" href="/assets/004-数据抽取的常见方法.html-jrfu7GOM.js" as="script"><link rel="prefetch" href="/assets/005-基于增量字段同步数据.html-DvTBGoX1.js" as="script"><link rel="prefetch" href="/assets/006-NIFI各个NAR包功能概述.html-BivR6YEc.js" as="script"><link rel="prefetch" href="/assets/007-Nar包加载机制源码解读.html-B8MJdANO.js" as="script"><link rel="prefetch" href="/assets/008-Nar包下的MANIFEST.MF.html-DRTxsk9e.js" as="script"><link rel="prefetch" href="/assets/009-Apache NIFI类资源隔离机制.html-zy5B-oR4.js" as="script"><link rel="prefetch" href="/assets/010-Apache NIFI Processor情况.html-dK3_XUJ_.js" as="script"><link rel="prefetch" href="/assets/011-理解connection.html-DDRekfQ8.js" as="script"><link rel="prefetch" href="/assets/012-理解maxThread设置.html-CiFSVdtA.js" as="script"><link rel="prefetch" href="/assets/013-RunDuration理解.html-DbnwgeEy.js" as="script"><link rel="prefetch" href="/assets/014-ContentRepositoryArchiving理解.html-Bcozh2Op.js" as="script"><link rel="prefetch" href="/assets/015-Controller Services是守护进程.html-DK6niOaD.js" as="script"><link rel="prefetch" href="/assets/016-NIFI调度.html-D0O9_vJ_.js" as="script"><link rel="prefetch" href="/assets/017-NIFI高可用.html-B_oYZF6u.js" as="script"><link rel="prefetch" href="/assets/018-通过配置优化NiFi性能.html-Biv4WHJo.js" as="script"><link rel="prefetch" href="/assets/019-NIFI里的数据库连接池.html-BOjCZq9H.js" as="script"><link rel="prefetch" href="/assets/020-为什么建议使用NIFI里的Record.html-QDcYnEXK.js" as="script"><link rel="prefetch" href="/assets/021-NIFI贡献代码.html-BTfVAQ6J.js" as="script"><link rel="prefetch" href="/assets/022-NIFI开启HTTPS.html-DEGfbtBo.js" as="script"><link rel="prefetch" href="/assets/023-ExecuteScript脚本教程.html-DxMRzjHY.js" as="script"><link rel="prefetch" href="/assets/024-内容存储库原理.html-Aw3w17n2.js" as="script"><link rel="prefetch" href="/assets/025-FlowFile存储库原理.html-NZBgubEU.js" as="script"><link rel="prefetch" href="/assets/026-预写日志(WAL).html-5sfl10tC.js" as="script"><link rel="prefetch" href="/assets/027-Provenance存储库原理.html-CsDdw4_w.js" as="script"><link rel="prefetch" href="/assets/028-NIFI架构.html-BIU7ROYw.js" as="script"><link rel="prefetch" href="/assets/029-NIFI事务原理.html-5iYpzJmZ.js" as="script"><link rel="prefetch" href="/assets/030-数据库字段类型.html-C1pGNtfO.js" as="script"><link rel="prefetch" href="/assets/031-1.14.html-CdiA3hdn.js" as="script"><link rel="prefetch" href="/assets/032-CaptureChangeMySQL.html-eZzAjKT2.js" as="script"><link rel="prefetch" href="/assets/033-流程告警.html-dK8RLNQP.js" as="script"><link rel="prefetch" href="/assets/037-MySQL全字段测试.html-a0LHqWiN.js" as="script"><link rel="prefetch" href="/assets/01-输入输出流.html-crH3U0ui.js" as="script"><link rel="prefetch" href="/assets/02-File.html-BknlTzHL.js" as="script"><link rel="prefetch" href="/assets/03-缓冲流BufferedInputStream与BufferedOutputStream.html-CQTJjsyM.js" as="script"><link rel="prefetch" href="/assets/04-缓冲流BufferedReader与BufferedWriter.html-DvbnfHHc.js" as="script"><link rel="prefetch" href="/assets/05-转换流InputStreamReader与OutputStreamWriter.html-DClJ6Iiv.js" as="script"><link rel="prefetch" href="/assets/06-ByteArrayInputStream与ByteArrayOutputStream.html-BCQYz8Er.js" as="script"><link rel="prefetch" href="/assets/07-CommonsIO2.5-FileUtils.html-COO3xckU.js" as="script"><link rel="prefetch" href="/assets/ByteArrayOutputStream.html-D6EJKok8.js" as="script"><link rel="prefetch" href="/assets/Java SPI机制.html-BrhRsog_.js" as="script"><link rel="prefetch" href="/assets/Java8_JVM内存模型.html-BgnPFne6.js" as="script"><link rel="prefetch" href="/assets/Java中atomic包中的原子操作类总结.html-BWpeSptk.js" as="script"><link rel="prefetch" href="/assets/Java中的锁.html-rBv1_yKf.js" as="script"><link rel="prefetch" href="/assets/Java内存模型原理.html-B2p53Vvw.js" as="script"><link rel="prefetch" href="/assets/Java反射.html-BGmgZF0t.js" as="script"><link rel="prefetch" href="/assets/Java导入语句中不宜使用通配符.html-CpUIYibw.js" as="script"><link rel="prefetch" href="/assets/Java类加载器.html-DVxWVqry.js" as="script"><link rel="prefetch" href="/assets/Java里带标签的break和continue.html-H4ij1g0G.js" as="script"><link rel="prefetch" href="/assets/Jvm-dump-jstack-jmap-jstat.html-D_98Mc01.js" as="script"><link rel="prefetch" href="/assets/java注解.html-d6wVYiH5.js" as="script"><link rel="prefetch" href="/assets/web的发展历史.html-BOJc7OK2.js" as="script"><link rel="prefetch" href="/assets/代码设计原理.html-owEKLky_.js" as="script"><link rel="prefetch" href="/assets/使用List.html-BP5fSDe2.js" as="script"><link rel="prefetch" href="/assets/偏向锁批量重偏向与批量撤销.html-DAPR2VmO.js" as="script"><link rel="prefetch" href="/assets/到底什么是classpath.html-_9IaXXnq.js" as="script"><link rel="prefetch" href="/assets/动手体验JVM中Class对象的唯一性.html-3vv_ZAxb.js" as="script"><link rel="prefetch" href="/assets/多线程基础知识总结.html-B0xmMH-C.js" as="script"><link rel="prefetch" href="/assets/打印Java对象头.html-DUXSamXj.js" as="script"><link rel="prefetch" href="/assets/深入了解Java锁.html-T5DhbU_0.js" as="script"><link rel="prefetch" href="/assets/相对路径与绝对路径去读取文件.html-_vmJ6Ju_.js" as="script"><link rel="prefetch" href="/assets/类加载机制.html-BmX4LS87.js" as="script"><link rel="prefetch" href="/assets/线程通信.html-DVb1DioJ.js" as="script"><link rel="prefetch" href="/assets/让你彻底理解Synchronized.html-D8XmLxGl.js" as="script"><link rel="prefetch" href="/assets/JsonJolt教程.html-CmCbya1N.js" as="script"><link rel="prefetch" href="/assets/JsonJolt教程英文版.html-DQvvXptv.js" as="script"><link rel="prefetch" href="/assets/使用jolt替换值.html-SYPraLno.js" as="script"><link rel="prefetch" href="/assets/001Spring基础知识.html-DzFQdOih.js" as="script"><link rel="prefetch" href="/assets/002Bean定义常见错误.html-Cq4xkN2i.js" as="script"><link rel="prefetch" href="/assets/003依赖注入常见错误上.html-D1sCr_CD.js" as="script"><link rel="prefetch" href="/assets/004依赖注入常见错误下.html-BGUU2N3t.js" as="script"><link rel="prefetch" href="/assets/005Bean生命周期常见错误.html-CipW83I1.js" as="script"><link rel="prefetch" href="/assets/006SpringAOP常见错误上.html-Bc1i-hUF.js" as="script"><link rel="prefetch" href="/assets/007SpringAOP常见错误下.html-BtGfmhNz.js" as="script"><link rel="prefetch" href="/assets/008Spring事件常见错误.html-DlfIdXZT.js" as="script"><link rel="prefetch" href="/assets/009SpringWebURL解析常见错误.html-D6pAT9bB.js" as="script"><link rel="prefetch" href="/assets/010SpringWebHeader解析常见错误.html-4l5KRYX5.js" as="script"><link rel="prefetch" href="/assets/011SpringWebBody转化常见错误.html-CrNko_2a.js" as="script"><link rel="prefetch" href="/assets/012SpringWeb参数验证常见错误.html-DKdT5_b4.js" as="script"><link rel="prefetch" href="/assets/013SpringWeb过滤器使用常见错误上.html-BSUQQMnt.js" as="script"><link rel="prefetch" href="/assets/014SpringWeb过滤器使用常见错误下.html-C81TNodB.js" as="script"><link rel="prefetch" href="/assets/001-管理OracleRedoLog.html-CM-Z2lfs.js" as="script"><link rel="prefetch" href="/assets/BIT的字节序.html-Bsjo2IzD.js" as="script"><link rel="prefetch" href="/assets/Oracle12cLogMiner分析Redo日志文件.html-DYyAUd8Y.js" as="script"><link rel="prefetch" href="/assets/基于水印的CDC框架.html-BMgUJ8uv.js" as="script"><link rel="prefetch" href="/assets/01-进程与线程基本概念.html-D0dziZlP.js" as="script"><link rel="prefetch" href="/assets/02-Java多线程入门类和接口.html-CVB_YDD_.js" as="script"><link rel="prefetch" href="/assets/03-线程组和线程优先级.html-DCBDrq68.js" as="script"><link rel="prefetch" href="/assets/04-Java线程的状态及主要转化方法.html-Bd3zigcS.js" as="script"><link rel="prefetch" href="/assets/05-Java线程间的通信.html-CbPwMY7J.js" as="script"><link rel="prefetch" href="/assets/06-Java内存模型基础知识.html-BeDTy9nb.js" as="script"><link rel="prefetch" href="/assets/07-重排序与happens-before.html-BN3QQkgA.js" as="script"><link rel="prefetch" href="/assets/08-volatitle.html-MPXr7Mqg.js" as="script"><link rel="prefetch" href="/assets/09-synchronized与锁.html-BpYU9wnv.js" as="script"><link rel="prefetch" href="/assets/10-CAS与原子操作.html-CypOOVeT.js" as="script"><link rel="prefetch" href="/assets/11-AQS.html-Rj1VRKM-.js" as="script"><link rel="prefetch" href="/assets/12-线程池原理.html-CZms-rwG.js" as="script"><link rel="prefetch" href="/assets/13-阻塞队列.html-yLnE7Z10.js" as="script"><link rel="prefetch" href="/assets/14-锁接口和类.html-wj_ZxRbW.js" as="script"><link rel="prefetch" href="/assets/15-并发容器集合.html-BjkdMLrX.js" as="script"><link rel="prefetch" href="/assets/16-CopyOnWrite容器.html-KTYQeDWv.js" as="script"><link rel="prefetch" href="/assets/17-通信工具类.html-2uLuCFcG.js" as="script"><link rel="prefetch" href="/assets/18-Fork_Join框架.html-CvXm8C2z.js" as="script"><link rel="prefetch" href="/assets/19-Java8Stream并行计算原理.html-BinTdOlv.js" as="script"><link rel="prefetch" href="/assets/20-计划任务.html-BFUi5Uw1.js" as="script"><link rel="prefetch" href="/assets/深入浅出Java多线程.html-CSijtVAQ.js" as="script"><link rel="prefetch" href="/assets/sf.html-DoaxDZE-.js" as="script"><link rel="prefetch" href="/assets/二叉搜索树的前驱和后继节点.html-CpS0vxYn.js" as="script"><link rel="prefetch" href="/assets/什么是红黑树.html-BTkBriTr.js" as="script"><link rel="prefetch" href="/assets/冒泡排序.html-DyoWKxjT.js" as="script"><link rel="prefetch" href="/assets/十大经典排序算法最强总结.html-B1SqWj0t.js" as="script"><link rel="prefetch" href="/assets/基于Java实现红黑树的基本操作.html-BHoPAVkk.js" as="script"><link rel="prefetch" href="/assets/并查集.html-CtRWR-rU.js" as="script"><link rel="prefetch" href="/assets/01-命名风格.html-BsssZiY3.js" as="script"><link rel="prefetch" href="/assets/02-常量定义.html-C1YJKjSM.js" as="script"><link rel="prefetch" href="/assets/03-代码格式.html-CnJHPu6q.js" as="script"><link rel="prefetch" href="/assets/04-OOP规约.html-RuvImEbm.js" as="script"><link rel="prefetch" href="/assets/05-日期时间.html-DfemeU4-.js" as="script"><link rel="prefetch" href="/assets/06-集合处理.html-BvXL0Nla.js" as="script"><link rel="prefetch" href="/assets/07-并发处理.html-CJJoJ92E.js" as="script"><link rel="prefetch" href="/assets/08-控制语句.html-D22VN0i7.js" as="script"><link rel="prefetch" href="/assets/09-注释规约.html-Cpf4YmE9.js" as="script"><link rel="prefetch" href="/assets/10-其它.html-B3HcFbO-.js" as="script"><link rel="prefetch" href="/assets/11-错误码.html-zKJGAp8L.js" as="script"><link rel="prefetch" href="/assets/12-异常处理.html-_fs_Wa9q.js" as="script"><link rel="prefetch" href="/assets/13-日志规约.html-D1EXVbqx.js" as="script"><link rel="prefetch" href="/assets/14-单元测试.html-CEB9Qb0z.js" as="script"><link rel="prefetch" href="/assets/15-安全规约.html-B8qM6jXx.js" as="script"><link rel="prefetch" href="/assets/16-建表规约.html-rSrtaoZZ.js" as="script"><link rel="prefetch" href="/assets/17-索引规约.html-DWU0uZwe.js" as="script"><link rel="prefetch" href="/assets/18-SQL语句.html-BbXqPZur.js" as="script"><link rel="prefetch" href="/assets/19-ORM映射.html-CIDouYID.js" as="script"><link rel="prefetch" href="/assets/20-应用分层.html-HaOfWj_E.js" as="script"><link rel="prefetch" href="/assets/21-二方库依赖.html-V2or5PAP.js" as="script"><link rel="prefetch" href="/assets/22-服务器.html-Cq0qcVza.js" as="script"><link rel="prefetch" href="/assets/23-设计规约.html-cJuyt9gQ.js" as="script"><link rel="prefetch" href="/assets/24-专有名词解释.html-CWbtcokP.js" as="script"><link rel="prefetch" href="/assets/25-错误码列表.html-CHfLEx53.js" as="script"><link rel="prefetch" href="/assets/手抄版.html-C8Q-ccdV.js" as="script"><link rel="prefetch" href="/assets/404.html-D0f4BK4R.js" as="script"><link rel="prefetch" href="/assets/index.html-FTm4Ta42.js" as="script"><link rel="prefetch" href="/assets/index.html-D5AbYr8Y.js" as="script"><link rel="prefetch" href="/assets/index.html-u8I-2ejk.js" as="script"><link rel="prefetch" href="/assets/index.html-DYyK7eIc.js" as="script"><link rel="prefetch" href="/assets/index.html-BmGrb96V.js" as="script"><link rel="prefetch" href="/assets/index.html-ZKg9q8oG.js" as="script"><link rel="prefetch" href="/assets/index.html-BystWD0N.js" as="script"><link rel="prefetch" href="/assets/index.html-CAFLs-Jj.js" as="script"><link rel="prefetch" href="/assets/index.html-B6Awbf7z.js" as="script"><link rel="prefetch" href="/assets/index.html-Wd5ymgaZ.js" as="script"><link rel="prefetch" href="/assets/index.html-C2F1CuM4.js" as="script"><link rel="prefetch" href="/assets/index.html-BrekTQB_.js" as="script"><link rel="prefetch" href="/assets/index.html-BlSIFmxW.js" as="script"><link rel="prefetch" href="/assets/index.html-CamfBLSI.js" as="script"><link rel="prefetch" href="/assets/index.html-BwTHpj9g.js" as="script"><link rel="prefetch" href="/assets/index.html-Bgx4aYtJ.js" as="script"><link rel="prefetch" href="/assets/index.html-BjVSlJb0.js" as="script"><link rel="prefetch" href="/assets/index.html-CV_CbxxP.js" as="script"><link rel="prefetch" href="/assets/index.html-Q86jGs6w.js" as="script"><link rel="prefetch" href="/assets/index.html-DJlgRxuI.js" as="script"><link rel="prefetch" href="/assets/index.html-Ckht57PU.js" as="script"><link rel="prefetch" href="/assets/index.html-C6bAp3LP.js" as="script"><link rel="prefetch" href="/assets/index.html-B_QHU0rR.js" as="script"><link rel="prefetch" href="/assets/index.html-hvwsAvzw.js" as="script"><link rel="prefetch" href="/assets/index.html-c0xDdHrR.js" as="script"><link rel="prefetch" href="/assets/index.html-BnE8Ne6o.js" as="script"><link rel="prefetch" href="/assets/index.html-DJG1cCxe.js" as="script"><link rel="prefetch" href="/assets/index.html-ZaMGxeP1.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/panda.gif" alt><!----><span class="vp-site-name hide-in-pad">Panda诚的博客</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->Home<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/timeline/" aria-label="时间轴"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-date" style=""></span><!--]-->时间轴<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/tag/" aria-label="Tags"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-tag" style=""></span><!--]-->Tags<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/zhangchengk" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/" aria-label="博客主页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->博客主页<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Apache NIFI开发</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Apache NIFI教程</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/001-NiFi%E6%9C%AF%E8%AF%AD.html" aria-label="NIFI术语"><!---->NIFI术语<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/002-%E5%B8%A6%E4%BD%A0%E4%BD%93%E9%AA%8CApacheNIFI.html" aria-label="带你体验Apache NIFI"><!---->带你体验Apache NIFI<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/003-NIFI%E5%85%A5%E9%97%A8.html" aria-label="NIFI读完即入门"><!---->NIFI读完即入门<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/004-%E6%95%B0%E6%8D%AE%E6%8A%BD%E5%8F%96%E7%9A%84%E5%B8%B8%E8%A7%81%E6%96%B9%E6%B3%95.html" aria-label="数据抽取的常见理论方法"><!---->数据抽取的常见理论方法<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/005-%E5%9F%BA%E4%BA%8E%E5%A2%9E%E9%87%8F%E5%AD%97%E6%AE%B5%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE.html" aria-label="基于增量字段同步数据"><!---->基于增量字段同步数据<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/006-NIFI%E5%90%84%E4%B8%AANAR%E5%8C%85%E5%8A%9F%E8%83%BD%E6%A6%82%E8%BF%B0.html" aria-label="各个NAR包功能概述"><!---->各个NAR包功能概述<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/007-Nar%E5%8C%85%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB.html" aria-label="Nar包加载机制源码解读"><!---->Nar包加载机制源码解读<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/008-Nar%E5%8C%85%E4%B8%8B%E7%9A%84MANIFEST.MF.html" aria-label="Nar包下的MANIFEST.MF"><!---->Nar包下的MANIFEST.MF<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/009-Apache%20NIFI%E7%B1%BB%E8%B5%84%E6%BA%90%E9%9A%94%E7%A6%BB%E6%9C%BA%E5%88%B6.html" aria-label="NIFI类资源隔离机制"><!---->NIFI类资源隔离机制<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/010-Apache%20NIFI%20Processor%E6%83%85%E5%86%B5.html" aria-label="Processor情况"><!---->Processor情况<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/011-%E7%90%86%E8%A7%A3connection.html" aria-label="深入理解Connection"><!---->深入理解Connection<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/012-%E7%90%86%E8%A7%A3maxThread%E8%AE%BE%E7%BD%AE.html" aria-label="最大线程池和处理器并发任务设置"><!---->最大线程池和处理器并发任务设置<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/013-RunDuration%E7%90%86%E8%A7%A3.html" aria-label="Run Duration深入理解"><!---->Run Duration深入理解<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/014-ContentRepositoryArchiving%E7%90%86%E8%A7%A3.html" aria-label="ContentRepositoryArchiving工作原理(译)"><!---->ContentRepositoryArchiving工作原理(译)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/015-Controller%20Services%E6%98%AF%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B.html" aria-label="Controller Services是守护进程"><!---->Controller Services是守护进程<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/016-NIFI%E8%B0%83%E5%BA%A6.html" aria-label="深入解析调度策略"><!---->深入解析调度策略<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/017-NIFI%E9%AB%98%E5%8F%AF%E7%94%A8.html" aria-label="探索NIFI集群的高可用"><!---->探索NIFI集群的高可用<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/018-%E9%80%9A%E8%BF%87%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96NiFi%E6%80%A7%E8%83%BD.html" aria-label="通过配置优化NiFi性能"><!---->通过配置优化NiFi性能<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/019-NIFI%E9%87%8C%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0.html" aria-label="NIFI里的数据库连接池"><!---->NIFI里的数据库连接池<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/020-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8NIFI%E9%87%8C%E7%9A%84Record.html" aria-label="建议使用NIFI里的Record"><!---->建议使用NIFI里的Record<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/021-NIFI%E8%B4%A1%E7%8C%AE%E4%BB%A3%E7%A0%81.html" aria-label="如何给NIFI贡献代码"><!---->如何给NIFI贡献代码<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/022-NIFI%E5%BC%80%E5%90%AFHTTPS.html" aria-label="NIFI开启HTTPS"><!---->NIFI开启HTTPS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/023-ExecuteScript%E8%84%9A%E6%9C%AC%E6%95%99%E7%A8%8B.html" aria-label="ExecuteScript组件脚本使用教程"><!---->ExecuteScript组件脚本使用教程<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/024-%E5%86%85%E5%AE%B9%E5%AD%98%E5%82%A8%E5%BA%93%E5%8E%9F%E7%90%86.html" aria-label="内容存储库原理"><!---->内容存储库原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/025-FlowFile%E5%AD%98%E5%82%A8%E5%BA%93%E5%8E%9F%E7%90%86.html" aria-label="FlowFile存储库原理"><!---->FlowFile存储库原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/026-%E9%A2%84%E5%86%99%E6%97%A5%E5%BF%97(WAL).html" aria-label="NiFi的Write-Ahead Log"><!---->NiFi的Write-Ahead Log<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/027-Provenance%E5%AD%98%E5%82%A8%E5%BA%93%E5%8E%9F%E7%90%86.html" aria-label="Provenance存储库原理"><!---->Provenance存储库原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/028-NIFI%E6%9E%B6%E6%9E%84.html" aria-label="NIFI架构"><!---->NIFI架构<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/029-NIFI%E4%BA%8B%E5%8A%A1%E5%8E%9F%E7%90%86.html" aria-label="NIFI事务原理"><!---->NIFI事务原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/030-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B.html" aria-label="NiFi支持的读写数据库字段类型"><!---->NiFi支持的读写数据库字段类型<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/031-1.14.html" aria-label="NIFI 1.14"><!---->NIFI 1.14<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/032-CaptureChangeMySQL.html" aria-label="CaptureChangeMySQL"><!---->CaptureChangeMySQL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/033-%E6%B5%81%E7%A8%8B%E5%91%8A%E8%AD%A6.html" aria-label="NIFI流程微信告警"><!---->NIFI流程微信告警<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/ApacheNIFI%E6%95%99%E7%A8%8B/034-JWT.html" aria-label="Apache NiFi中的JWT身份验证"><!---->Apache NiFi中的JWT身份验证<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/037-MySQL%E5%85%A8%E5%AD%97%E6%AE%B5%E6%B5%8B%E8%AF%95.html" aria-label="MySQL全字段读写测试(NIFI 1.15.3)"><!---->MySQL全字段读写测试(NIFI 1.15.3)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/ApacheNIFI%E6%95%99%E7%A8%8B/000-ApacheNIFI%E5%8E%86%E5%8F%B2.html" aria-label="NIFI简史"><!---->NIFI简史<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">IO流(java)</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">JAVA</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">JOLT</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring常见错误</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">数据库 CDC</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">深入浅出 Java多线程</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">算法</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">阿里 Java开发手册</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Apache NiFi中的JWT身份验证</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">张诚</span></span><span property="author" content="张诚"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-01-19T00:00:00.000Z"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color6 clickable" role="navigation">ApacheNIFI教程</span><!--]--><meta property="articleSection" content="ApacheNIFI教程"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color0 clickable" role="navigation">NIFI</span><!--]--><meta property="keywords" content="NIFI"></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 21 分钟</span><meta property="timeRequired" content="PT21M"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#本文目的">本文目的</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#背景知识">背景知识</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#jwt的组成元素">JWT的组成元素</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#jwt-header">JWT Header</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#jwt-payload">JWT Payload</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#jwt-signature">JWT Signature</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#简介">简介</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#实现概要">实现概要</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nifi最初的jwt实现">NIFI最初的JWT实现</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nifi新版的jwt实现">NIFI新版的JWT实现</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#更新前后对比">更新前后对比</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#库对比">库对比</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#秘钥的生成对比">秘钥的生成对比</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#秘钥存储的对比">秘钥存储的对比</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#签名算法的对比">签名算法的对比</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#token失效的对比">Token失效的对比</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#浏览器">浏览器</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#总结">总结</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><blockquote><p>大部分文章译自原文：https://exceptionfactory.com/posts/2021/10/23/improving-jwt-authentication-in-apache-nifi/ 同时结合译文，参照NIFI(1.15)源码进行分析讲述举例说明</p></blockquote><h2 id="本文目的" tabindex="-1"><a class="header-anchor" href="#本文目的"><span>本文目的</span></a></h2><ol><li>深入对Apache NiFi的新版JWT身份验证深入理解。</li><li>为自定义外部应用程序访问使用了JWT身份验证的NIFI服务提供参考和开发依据。</li></ol><h2 id="背景知识" tabindex="-1"><a class="header-anchor" href="#背景知识"><span>背景知识</span></a></h2><p><code>JSON Web Tokens</code>为众多Web应用程序和框架提供了灵活的身份验证和授权标准。<a href="https://datatracker.ietf.org/doc/html/rfc7519" target="_blank" rel="noopener noreferrer">RFC 7519</a>概述了JWT的基本要素，枚举了符合公共声明属性的所需编码，格式和已注册的<code>声明</code>属性名称(payload里属性称为<code>声明</code>)。<a href="https://datatracker.ietf.org/doc/html/rfc7515" target="_blank" rel="noopener noreferrer">RFC 7515</a>中的JSON Web签名和<a href="https://datatracker.ietf.org/doc/html/rfc7518" target="_blank" rel="noopener noreferrer">RFC 7518</a>中的JSON Web算法描述了JWT的支持标准，其他的比如<a href="https://en.wikipedia.org/wiki/OAuth" target="_blank" rel="noopener noreferrer">OAuth 2.0</a>框架的安全标准构建在这些支持标准上，就可以在各种服务中启用授权。</p><p>用于生成和验证<code>JSON Web Tokens</code>的库可用于所有主流的编程语言，这使得它成为许多平台上(身份验证)的流行方法。由于它的灵活性和几个库中的实现问题，一些人批评了JWT的应用程序安全性。尽管与传统的服务器会话管理相比，JWT有一定程度的复杂性，但<code>JSON格式</code>、<code>标准字段命名</code>和<code>加密的签名</code>的这些特性还是使<code>JSON Web Tokens</code>得到了广泛的应用。</p><h2 id="jwt的组成元素" tabindex="-1"><a class="header-anchor" href="#jwt的组成元素"><span>JWT的组成元素</span></a></h2><p>JWT标准定义了令牌的三个元素:<code>header</code>、<code>payload</code>和<code>signature</code>。每个元素使用<a href="https://en.wikipedia.org/wiki/Base64" target="_blank" rel="noopener noreferrer">Bas64</a>编码的字符串组成，以便与HTTP头所需的ASCII字符集相兼容。序列化的令牌结构使用句<code>点(.)</code>字符分隔这三个元素。<code>header</code>和<code>payload</code>元素包含一个或多个属性的JSON对象，<code>signature</code>元素包含了<code>header</code>和<code>payload</code>元素的二进制签名。<a href="https://datatracker.ietf.org/doc/html/rfc7519#section-3.1" target="_blank" rel="noopener noreferrer">RFC 7519 3.1</a>节提供了一个JWT示例，其中包括每个元素的编码和解码表示。</p><h3 id="jwt-header" tabindex="-1"><a class="header-anchor" href="#jwt-header"><span>JWT Header</span></a></h3><p>大多数JWT都包括一个带有<code>签名算法</code>的<code>header</code>，该<code>签名算法</code>描述了<code>加密密钥的类型</code>和<code>哈希算法</code>。JSON Web签名标准定义了利用基于<a href="https://en.wikipedia.org/wiki/HMAC" target="_blank" rel="noopener noreferrer">哈希消息验证码</a>的<code>对称密钥</code>算法，以及几种<code>非对称密钥</code>算法。两种类型的加密密钥策略都依赖于<a href="https://en.wikipedia.org/wiki/SHA-2" target="_blank" rel="noopener noreferrer">SHA-2</a>哈希算法，其输出大小可选，分别为256、384或512位。</p><p>比如<code>header</code>指定使用SHA-256的对称密钥HMAC验证，可以在JSON中表示如下:</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">&quot;typ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;JWT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">&quot;alg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;HS256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Base64编码后为</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="jwt-payload" tabindex="-1"><a class="header-anchor" href="#jwt-payload"><span>JWT Payload</span></a></h3><p>JWT的<code>payload</code>包含了一些可扩展数量的属性，称之为<code>声明</code>。<a href="https://datatracker.ietf.org/doc/html/rfc7519#section-4.1" target="_blank" rel="noopener noreferrer">RFC 7519第4.1节</a>定义了一套已经注册了的用于提供基本身份和有效性细节的<code>声明</code>(我们自定义声明时应别名于这些声明名称关键字)。具体的实现服务中的<code>payload</code>还可以包括自定义的<code>声明</code>，以提供额外的授权状态信息。</p><p>比如<code>payload</code>指定了一个带有用户名和过期时间戳的声明，可以使用以下JSON表示:</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">&quot;sub&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">&quot;exp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1640995200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Base64编码后为</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>eyJzdWIiOiJ1c2VybmFtZSIsImV4cCI6MTY0MDk5NTIwMH0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="jwt-signature" tabindex="-1"><a class="header-anchor" href="#jwt-signature"><span>JWT Signature</span></a></h3><p><code>signature</code>提供了<code>header</code>和<code>payload</code>的可验证签名。更改<code>header</code>或<code>payload</code>的任何部分都会导致不同的签名。使用对称密钥或非对称密钥对的私钥生成<code>signature</code>，这个<code>signature</code>就可以(使用公钥)被用来去验证<code>header</code>和<code>payload</code>是否被篡改，是否还是服务最初发布的原始值。<a href="https://datatracker.ietf.org/doc/html/rfc7519#section-6" target="_blank" rel="noopener noreferrer">RFC 7519第6节</a>描述了不安全的jwt，其中签名元素为空字符串，签名算法为空，但是这种实现并不常见，需要额外的安全措施，并不适合大多数使用场景。</p><h2 id="简介" tabindex="-1"><a class="header-anchor" href="#简介"><span>简介</span></a></h2><p>Apache NiFi从<code>0.4.0</code>版本起就开始利用<code>JSON Web Tokens</code>来提供持久的用户界面访问。除了使用<code>X.509证书</code>的<code>TLS双向认证</code>外，jwt还支持大多数NiFi认证策略，包括<code>LDAP</code>、<code>Kerberos</code>、<code>OpenID Connect</code>和<code>SAML</code>。在成功交换凭证之后，NiFi服务生成并返回一个JWT, web浏览器将使用它来处理所有后续请求。这种方法将对身份提供者的影响最小化，还简化了完成登录过程后的应用程序访问。</p><p>尽管JWT的生成、签名和验证对NiFi用户或管理员并不直接可见，但这些功能对于应用程序的安全性来说是必不可少的。NiFi最近的变化改进了JWT处理的各个方面，增强了服务器和客户端处理中的应用程序安全性。这些更新涵盖了NiFi在登录处理过程中产生的所有<code>JSON Web Tokens</code>的<code>密钥生成</code>、<code>密钥存储</code>、<code>签名验证</code>和<code>令牌撤销</code>。在评估认证策略和考虑整体系统安全时，根据这些更新的实现来理解NiFi JWT处理还是很有用的。</p><h2 id="实现概要" tabindex="-1"><a class="header-anchor" href="#实现概要"><span>实现概要</span></a></h2><p>对JWT处理的更新几乎涉及到实现的每个方面，从支持库到客户机请求格式。最初的实现和更新后的实现都依赖于<a href="https://spring.io/projects/spring-security" target="_blank" rel="noopener noreferrer">Spring Security</a>来提供web应用程序安全的基础结构。</p><h3 id="nifi最初的jwt实现" tabindex="-1"><a class="header-anchor" href="#nifi最初的jwt实现"><span>NIFI最初的JWT实现</span></a></h3><p>NiFi 1.14.0和更早版本的JSON Web令牌实现包括以下特性:</p><ul><li>基于<a href="https://github.com/jwtk/jjwt" target="_blank" rel="noopener noreferrer">JJWT</a>库</li><li>使用随机UUID为每个经过身份验证的用户生成<code>对称密钥</code></li><li>在位于文件系统上的<code>H2数据库中存储</code>对称密钥</li><li>基于<a href="https://en.wikipedia.org/wiki/HMAC" target="_blank" rel="noopener noreferrer">HMAC</a>和SHA-256的JWT签名验证</li><li>基于<code>删除对称密钥</code>的<code>令牌撤销</code></li><li>Web浏览器使用HTTP <code>Authorization</code>头和使用<code>本地存储(Local Storage)</code>来存储Token</li></ul><h3 id="nifi新版的jwt实现" tabindex="-1"><a class="header-anchor" href="#nifi新版的jwt实现"><span>NIFI新版的JWT实现</span></a></h3><p>JWT处理的更新包括以下特性:</p><ul><li>基于<a href="https://docs.spring.io/spring-security/site/docs/current/reference/html5/#spring-security-oauth2-jose" target="_blank" rel="noopener noreferrer">Spring Security OAuth 2.0 JOSE</a>和<a href="https://connect2id.com/products/nimbus-jose-jwt" target="_blank" rel="noopener noreferrer">Nimbus JOSE JWT</a>库</li><li>使用RSA算法生成<code>非对称密钥</code>对，密钥大小为4096位</li><li>私钥存储在应用程序内存中</li><li>公钥存储在持久化到文件系统的<a href="http://nifi.apache.org/docs/nifi-docs/html/administration-guide.html#state_providers" target="_blank" rel="noopener noreferrer">local State Provider</a></li><li><code>密钥对</code>基于可配置的持续时间进行更新，默认为1小时</li><li>使用<a href="https://en.wikipedia.org/wiki/Probabilistic_signature_scheme" target="_blank" rel="noopener noreferrer">RSASSA-PSS</a>和SHA-512进行JWT签名验证</li><li>基于<code>State Provider记录</code>失效的<code>令牌标识符</code>，实现<code>令牌撤销</code></li><li>Web浏览器使用限制JavaScript访问的HTTP会话<code>cookie</code>来存储Token</li></ul><h2 id="更新前后对比" tabindex="-1"><a class="header-anchor" href="#更新前后对比"><span>更新前后对比</span></a></h2><p>重构NiFi JWT涉及到对<code>nifi-web-security</code>模块的大量代码更改，包括配置和请求处理组件。更改JWT生成和处理还提供了引入新单元测试来验证组件行为的机会。Spring Security框架的最新开发允许用标准实现替换几个自定义类。虽然NiFi没有实现<code>OAuth 2.0</code>规范，但更新后的JWT实现使用了几个<code>Spring Security OAuth 2.0</code>组件，它们提供了可配置的令牌验证。一个新的配置类将支持的组件连接在一起，各个元素使用私有变量来指定各个方面，比如键大小和处理算法。虽然一些属性可以作为NiFi应用程序属性公开，但内部默认值为所有部署提供了高级别的安全性。</p><blockquote><p>使用默认值就够用了</p></blockquote><h3 id="库对比" tabindex="-1"><a class="header-anchor" href="#库对比"><span>库对比</span></a></h3><p>自JWT处理在<code>NiFi 0.4.0</code>中首次亮相以来，就使用<code>JJWT</code>库实现令牌的生成、签名和验证。<code>JJWT</code>库里包含了大量的特性和大量的测试，而<code>Spring Security OAuth 2.0</code>依赖于<code>Nimbus JOSE JWT</code>库，后者提供了一些额外的功能，例如使用JSON Web Keys对令牌验证的简化支持。这两个库都为JWT处理提供了坚实的基础，但对于依赖于<code>Spring Security OAuth 2.0</code>的应用程序来说，<code>Nimbus JOSE JWT</code>是构建自定义功能的最直接的选择。随着<code>Spring Security</code>依赖的引入，包括<code>spring-security-oauth2-resource-server</code>和<code>spring-security-oauth2-jose</code>，迁移到<code>Nimbus JOSE JWT</code>是首选。</p><p><code>Spring Security OAuth 2.0</code>库提供了许多用于实现令牌身份验证的有用组件。<code>JwtAuthenticationProvider</code>实现了标准的<code>Spring Security AuthenticationProvider</code>接口，并允许与NiFi授权组件相匹配的自定义身份验证转换策略。利用<code>Spring Security</code>消除了对自定义类的需要。<code>Spring Security</code>还提供了通用的<code>JwtDecoder</code>和<code>OAuth2TokenValidator</code>接口，用于抽象令牌的解析和验证。通过可扩展和可组合的实现，<code>Spring Security OAuth 2.0</code>模块简化了NiFi JWT处理，并与web安全配置的其余部分自然匹配。</p><p><code>Nimbus库</code>包含了几个标准接口，包括<code>JWTProcessor</code>和<code>JWSKeySelector</code>，它们为声明验证和签名验证提供了扩展点。这些接口的实现支持与<code>Spring Security OAuth 2.0</code>组件的直接集成，还提供了针对离散特性进行单元测试的机会。<code>Nimbus库</code>还包括一套完整的JWT对象建模类，这使得它更容易实现特性，而无需担心直接JSON解析和序列化。</p><h3 id="秘钥的生成对比" tabindex="-1"><a class="header-anchor" href="#秘钥的生成对比"><span>秘钥的生成对比</span></a></h3><p>用于<code>JSON Web signature</code>生成和验证的<code>加密密钥</code>是实现安全性的一个基本元素。关键是要有足够的<code>长度</code>和<code>随机性</code>。一个弱密钥或被破坏的密钥可能被对手获取并冒充其他用户或提供升级特权的恶意jwt。</p><p><code>NiFi 1.14.0</code>及<code>之前版本</code>使用<code>java.util.UUID.randomUUID()</code>为每个经过身份验证的用户生成唯一的<code>对称密钥</code>。为每个用户提供一个唯一的密钥可以确保一个被破坏的密钥不能用于为不同的用户生成JWT。尽管随机UUID方法生成36个字符的字符串，但有效的随机性还是要小得多。</p><p>随机UUID方法使用<code>java.security.SecureRandom</code>生成16个随机字节，但是<a href="https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_4_(random)" target="_blank" rel="noopener noreferrer">UUID版本4</a>需要使用一个字节来表示UUID版本，一个字节来表示变体，将有效的随机字节数减少到14，或122位。尽管潜在的随机值的数量仍然非常大，但按照<a href="https://datatracker.ietf.org/doc/html/rfc7518#section-3.2" target="_blank" rel="noopener noreferrer">RFC 7518 Section 3.2</a>里的描述，122位还不到使用SHA-256的HMAC所需的最小密钥长度的一半。</p><p>更新后的JWT实现将<code>HMAC SHA-256</code>算法替换为基于<code>RSA密钥对</code>的数字签名。NiFi不是为每个用户创建一个密钥，而是生成一个密钥大小为4096位的<code>共享密钥对</code>。<a href="https://datatracker.ietf.org/doc/html/rfc7518#section-3.5" target="_blank" rel="noopener noreferrer">RFC 7518 Section 3.5</a>要求使用RSASSA-PSS时密钥最小为2048位，NiFi值为4096符合当前推荐的强RSA密钥对。NiFi使用标准的<code>Java KeyPairGenerator</code>接口，该接口委托给已配置的Java安全提供程序，并利用SecureRandom类进行随机生成。</p><blockquote><p>NiFi新版的JWT的<code>RSA密钥对</code>中，私钥用于生成<code>signature</code>，公钥要验证<code>signature</code>。</p></blockquote><h4 id="秘钥更新周期" tabindex="-1"><a class="header-anchor" href="#秘钥更新周期"><span>秘钥更新周期</span></a></h4><p>为了减少潜在的密钥泄露，NiFi以可配置的时间间隔生成新的密钥对，默认为1小时。nifi中的以下属性，可配置属性调整秘钥更新间隔:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>nifi.security.user.jws.key.rotation.period</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>该属性支持使用ISO 8601标准的间隔时间，默认值为<code>PT1H</code>。更频繁地生成新密钥对会使用额外的计算资源，而较少频繁地更新会影响被破坏的密钥保持有效的时间长度。</p><blockquote><p><code>JwtAuthenticationSecurityConfiguration</code>配置类在生成bean的<code>keyGenerationCommand()</code>方法中，会利用Spring的<code>ThreadPoolTaskScheduler</code>,注册一个<code>KeyGenerationCommand</code>的定时任务，调度周期就是<code>nifi.security.user.jws.key.rotation.period</code>(默认一小时)。 <code>KeyGenerationCommand</code>的<code>run</code>方法会被调度生成秘钥对，以及一个UUID(<code>JWT ID</code>)，然后更新内存中的私钥，将新的公钥存在Local State中。</p></blockquote><h3 id="秘钥存储的对比" tabindex="-1"><a class="header-anchor" href="#秘钥存储的对比"><span>秘钥存储的对比</span></a></h3><p>最初的NiFi JWT实现将生成的对称密钥存储在位于文件系统上的H2数据库中。数据库表为每个用户建立一条记录，这条记录将生成的UUID与用户标识符关联起来。在<code>NiFi 1.10.0</code>之前，H2数据库在初次登录后为每个用户保留相同的UUID对称密钥。这种方法不支持任何类型的JWT撤销，依赖于<code>过期声明</code>来使令牌撤销。</p><p>在<code>NiFi 1.10.0</code>发布更新后，注销用户界面删除了用户当前的对称密钥，有效地撤销了当前令牌，并强制在后续登录时生成一个新的UUID。尽管有这些改进，但还是使用了没有任何额外保护的H2数据库存储对称密钥。</p><p>更新后的实现利用非对称加密的属性，将生成的<code>私钥</code>与<code>公钥``分开存储</code>。NiFi将当前的<code>私钥保存在内存中</code>，并将相关的<code>公钥存储在Local State Provider</code>中。这种方法允许NiFi在应用程序重启后仍可以使用公钥验证当前令牌，同时避免不安全的私钥存储。默认的Local State Provider将条目保存在NiFi安装目录下名为local的目录中。</p><blockquote><p>私钥用于生成签名，存在内存中。公钥用于校验签名是否合法，存在Local State中。 源码<code>StandardJwsSignerProvider</code>中的<code>currentSigner</code>里存的有私钥，只在内存，无持久化。 在源码<code>StandardVerificationKeyService</code>的<code>save</code>方法里可以看到，存到state中的是key就是所谓的<code>JWT ID</code>(生成秘钥对的时候同时生成的UUID)，value是一个<code>VerificationKey</code>对象序列化后的字符串，其中包含了公钥，算法和公钥的过期时间等信息(新生成的公钥过期时间由<code>nifi.security.user.jws.key.rotation.period</code>配置决定，默认一小时，但后面在签名时，会被新生成的Token的过期时间所覆盖)。</p></blockquote><h3 id="签名算法的对比" tabindex="-1"><a class="header-anchor" href="#签名算法的对比"><span>签名算法的对比</span></a></h3><p>基于密钥生成和密钥存储的改变，新的NiFi JWT实现使用<code>PS512</code> JSON Web签名算法代替<code>HS256</code>(<code>HMAC</code>的<code>SHA-256</code>算法依赖于对称密钥来生成签名和验证，而其他算法则使用私钥进行签名，使用公钥进行验证)。由于NiFi同时充当令牌颁发者和资源服务器，HMAC SHA-256算法提供了一个可接受的实现。但是，在令牌创建和验证中使用相同的密钥，需要对敏感信息进行持久的存储，而迁移到基于<code>非对称密钥对</code>的算法会消除这一需求。</p><p>在技术术语中，使用<code>HMAC SHA-256</code>生成的JWT的签名部分不是一个加密签名，而是一个提供数据完整性度量的消息验证码。<code>PS512</code>算法是利用非对称密钥对的几个选项之一。<code>RS512</code>和<code>PS512</code>都使用RSA密钥对，但<code>PS512</code>使用更新的RSA签名方案和<a href="https://datatracker.ietf.org/doc/html/rfc8017#section-8.1" target="_blank" rel="noopener noreferrer">RFC 8017 Section 8.1</a>中的<code>Appendix-Probabilistic Signature Scheme</code>策略。与<code>RSASSA-PKCS1-v1_5</code>相比，<code>RSASSA-PSS</code>标准提供了更好的安全性，<code>RSASSA-PKCS1-v1_5</code>嵌入了一个哈希函数规范，该规范可能会被较弱的替代方案替代。尽管<a href="https://datatracker.ietf.org/doc/html/rfc8017#section-8" target="_blank" rel="noopener noreferrer">RFC 8017 Section 8</a>指出，目前还没有针对支持<code>RS512</code>的签名策略的已知攻击，但还是推荐使用<code>PS512</code>算法。其他新的非对称密钥对算法也可用，如<a href="https://datatracker.ietf.org/doc/html/rfc8037" target="_blank" rel="noopener noreferrer">RFC 8037 3.1节</a>中定义的<code>Edwards-curve Ed25519</code>，这些算法需要额外的支持库，NiFi可以考虑在未来的版本中包含这些支持库。</p><h3 id="token失效的对比" tabindex="-1"><a class="header-anchor" href="#token失效的对比"><span>Token失效的对比</span></a></h3><p>随着NIFI从<code>对称密钥</code>向<code>共享的非对称密钥对</code>的转变，有必要引入一种新的实现<code>令牌撤销</code>的方法。</p><p><code>过期机制</code>强制令牌拥有有限的生命周期，<code>最长可达12小时</code>，而<code>令牌撤销</code>可以确保完成注销过程后令牌不再有效。</p><p>NiFi版本<code>1.10.0</code>到<code>1.14.0</code>通过删除用户的对称密钥实现了有效的<code>令牌撤销</code>，而更新后的实现则是通过记录和跟踪被撤销的令牌标识符来实现的<code>令牌撤销</code>。</p><p><a href="https://datatracker.ietf.org/doc/html/rfc7519#section-4.1.7" target="_blank" rel="noopener noreferrer">JWT ID</a>声明提供了标识惟一令牌的标准方法。在令牌生成期间，NiFi分配一个<code>随机UUID作为JWT ID</code>。当用户发起注销过程时，NiFi记录下这个对应的JWT ID，NiFi根据记录的JWT ID拒绝未来的请求，这种方式使NiFi能够处理令牌发放和令牌失效之间的间隔状态。<code>JWT ID</code>的记录依赖于NiFi<code>Local State Provider</code>，在重启时会被清理一遍(清理那些过期的)。这种撤销策略只存储最少的信息，更加细粒度的使用了标准的JWT属性。同时NiFi使用可配置的秘钥更新周期来查找和删除过期的失效记录。</p><blockquote><p>令牌失效有两种，一种是令牌过期，一种是用户发起注销引起的<code>令牌撤销</code>。 前文提及，公钥存储在<code>Local State</code>，key就是<code>JWT ID</code>，value是一个对象序列化后的字符串，里面包含了公钥的过期时间。源码<code>JwtAuthenticationSecurityConfiguration</code>配置类在生成bean的<code>keyExpirationCommand()</code>方法中，会利用Spring的<code>ThreadPoolTaskScheduler</code>,注册一个<code>KeyExpirationCommand</code>的定时任务，调度周期就是<code>nifi.security.user.jws.key.rotation.period</code>(默认一小时)。<code>KeyExpirationCommand</code>会调用<code>StandardVerificationKeyService</code>中<code>deleteExpired()</code>方法，用来清理过期的公钥记录。 【注意】：虽然公钥有过期时间(默认一小时)，会被定时清理，但是这个过期时间会在生成Token时被Token中的过期时间覆盖，比如生成的token默认过期时间12小时，则公钥的过期时间也会更新成12小时。而每次生成的<code>JWT ID</code>不同，Local State(可以简单理解成一个map)中是可以同时存在多个时段的公钥信息。举个形象点的例子，NIFI启动后生成了一个共享的秘钥对，其中公钥存储到了Local State中，过期时间是默认值一小时(假定我们没有修改<code>nifi.security.user.jws.key.rotation.period</code>)。过了40分钟后，此时公钥过期时间还剩下20分钟，然后用户张三登陆了NiFi，NIFI程序验证通过了张三的用户名和密码后，要生成并返回JWT，假定生成的Token的过期时间是12小时，其中在生成<code>signature</code>的时候会将这个12小时的过期时间更新在当前的公钥存储里，于是乎此时公钥过期时间变成了12小时。然后再过20分钟(满一小时了)，NIFI程序自动生成了新的秘钥对，内存中的私钥被替换成了新的，Local State中增加了新的公钥，即张三登陆时拿到的那个Token所对应的所需要的公钥还在Local State中。 用户完成登出过程后程序会调用<code>StandardJwtLogoutListener</code>的<code>logout(final String bearerToken)</code>方法，方法中会调用<code>StandardJwtRevocationService</code>的<code>setRevoked(final String id, final Instant expiration)</code>方法，将当前的<code>JWT ID</code>记录下来，下一次这个Token发起请求的时候就会拒绝访问。同理公钥存储的过期清理的定时任务，<code>JWT ID</code>也有定时任务进行过期清理，这里不赘述。</p></blockquote><h3 id="浏览器" tabindex="-1"><a class="header-anchor" href="#浏览器"><span>浏览器</span></a></h3><p>在JWT处理的最初实现中，NiFi使用HTTP <code>Authorization</code> header传递令牌，使用<a href="https://datatracker.ietf.org/doc/html/rfc6750#section-2.1" target="_blank" rel="noopener noreferrer">RFC 6750 Section 2.1</a>中定义的<code>Bearer</code>方案。在成功交换凭证之后，NiFi用户界面使用<code>Local Storage</code>存储JWT进行持久访问。基于令牌寿命和跨浏览器实例的持久存储，用户界面维护一个经过身份验证的会话，而不需要额外的访问凭据请求。该接口还利用令牌的存在来指示是否显示登出链接。</p><h4 id="本地存储的问题" tabindex="-1"><a class="header-anchor" href="#本地存储的问题"><span>本地存储的问题</span></a></h4><p>使用标准HTTP <code>Authorization</code> header提供了在后续请求中传递JWT的直接方法，但是利用<code>Local Storage</code>会引起关于令牌本身安全性的潜在问题。浏览器<code>Local Storage</code>在应用程序重新启动时持续存在，如果用户在没有完成NiFi注销过程的情况下关闭浏览器，令牌将保持持久性，并可用于未来的浏览器会话。而在NiFi用户界面中执行的所有JavaScript代码都可以使用本地存储，可能导致NIFI受到跨站点脚本攻击。基于这些原因，Web应用程序安全方面建议不要将任何敏感信息持久化到<code>Local Storage</code>。</p><p>除了潜在的安全问题外，使用<code>Local Storage</code>还会在不同的浏览器实例中访问应用程序资源。NiFi内容查看器等特性需要实现自定义的一次性密码身份验证策略，当浏览器试图加载高级用户界面扩展的资源时，也会导致访问问题。</p><blockquote><p>Local Storage:<a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#local-storage" target="_blank" rel="noopener noreferrer">https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#local-storage</a>：Also known as Offline Storage, Web Storage. Underlying storage mechanism may vary from one user agent to the next. In other words, any authentication your application requires can be bypassed by a user with local privileges to the machine on which the data is stored. Therefore, it&#39;s recommended to avoid storing any sensitive information in local storage where authentication would be assumed.</p></blockquote><h4 id="基于cookie的实现" tabindex="-1"><a class="header-anchor" href="#基于cookie的实现"><span>基于Cookie的实现</span></a></h4><p>为了解决安全和可用性问题，NiFi最近的更新使用了HTTP会话<code>cookie</code>替换了JWT<code>Local Storage</code>。会话<code>cookie</code>实现使用<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#restrict_access_to_cookies" target="_blank" rel="noopener noreferrer">HttpOnly</a>属性来限制访问，使其对JavaScript不可用，这缓解了一些潜在的漏洞。浏览器在重新启动时不维护会话<code>cookie</code>，这避免了与有效或陈旧令牌的持久性相关的问题。</p><p>新的实现使用了<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite" target="_blank" rel="noopener noreferrer">SameSite</a>属性的<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite#strict" target="_blank" rel="noopener noreferrer">Strict</a>设置，该设置指示支持浏览器避免在第三方站点发起的请求中发送cookie。会话cookie还使用<a href="https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis-05#section-4.1.3" target="_blank" rel="noopener noreferrer">Cookie Name Prefixes</a>来通知支持它的浏览器，cookie必须包含<a href="https://owasp.org/www-community/controls/SecureCookieAttribute" target="_blank" rel="noopener noreferrer">Secure</a>属性，要求在后续的请求中传输使用HTTPS。</p><p>由于JavaScript对HTTP会话<code>cookie</code>的访问限制，更新后的实现还采用了一种不同的方法来注销支持状态。NiFi用户界面将过期时间戳存储在<code>Session Storage</code>中，而不是将整个令牌存储在<code>Local Storage</code>中。与会话cookie类似，浏览器在关闭时从<code>Session Storage</code>中删除项目。此策略依赖于存储最小数量的信息，且使用寿命较短，从而避免了与令牌本身相关的安全问题和潜在的持久性问题。</p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><p>NiFi中的<code>JSON Web Tokens</code>并不是Web应用程序安全最明显的方面，但它们在许多部署配置中起到了至关重要的作用。作为一个顶级的开源项目，开发一个最佳的JWT实现需要考虑许多因素。<code>NiFi 0.4.0</code>中JWT支持的最初部署解决了各种用例，但技术进步和最近的库开发为改进实现提供了几个机会。更新后的JWT集成增强了服务器和浏览器代码中的安全性，为潜在的和理论上的攻击提供了额外的保护。web应用安全的大部分方面都需要不断的评估，NiFi JWT支持也不例外。</p><blockquote><p>关于请求NIFI后端API，以表单形式将<code>username</code> <code>password</code>(<code>application/x-www-form-urlencoded</code>)Post到https://XX:8443/access/token，返回token然后增加到Cookie(name是<code>__Secure-Authorization-Bearer</code>)。 如果想避免到NIFI界面登陆，直接重定向到流程，同域的还好说，将token添加到cookie中就好了，而如果是跨域就有些麻烦了。跨域的话最直接的方式就是反向代理(比如nginx)NIFI的地址，使与自定义的web应用同域。还有一种稍微复杂点的需要开发的操作，我是这么干的，我自定义了一套无侵入源码NIFI的多用户多租户的登陆以及授权(一个nar)，在NIFI免安全认证开放一个Get请求API(自定义的无侵入源码的war)，向这个API传递token和groupId参数，然后在NIFI程序里设置cookie并重定向，最后这种方案有时间的话再写篇文章进行说明。</p></blockquote></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/zhangchengk/edit/main/src/ApacheNIFI教程/034-JWT.md" aria-label="在 GitHub 上编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: zhangchengk@yonyou.com">zhangcheng</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/ApacheNIFI%E6%95%99%E7%A8%8B/033-%E6%B5%81%E7%A8%8B%E5%91%8A%E8%AD%A6.html" aria-label="NIFI流程微信告警"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->NIFI流程微信告警</div></a><a class="route-link auto-link next" href="/ApacheNIFI%E6%95%99%E7%A8%8B/037-MySQL%E5%85%A8%E5%AD%97%E6%AE%B5%E6%B5%8B%E8%AF%95.html" aria-label="MySQL全字段读写测试(NIFI 1.15.3)"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">MySQL全字段读写测试(NIFI 1.15.3)<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">读书又笔记</div><div class="vp-copyright">Copyright © 2024 张诚 </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DiO1FYyc.js" defer></script>
  </body>
</html>
